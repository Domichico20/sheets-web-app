<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2487.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
    span.s1 {font: 12.0px 'Apple Color Emoji'}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;title&gt;Google Sheets Manager&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;!-- Preload login background --&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;link rel="preload" as="image" href="bg.jpg"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;!-- Preload app background --&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;link rel="preload" as="image"</p>
<p class="p1"><span class="Apple-converted-space">    </span>href="https://raw.githubusercontent.com/Domichico20/sheets-web-app/main/pexels-codioful-6985045.jpg"&gt;</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;link rel="preload" as="image" href="logo.png"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;link rel="preload" as="image" href="https://raw.githubusercontent.com/Domichico20/sheets-web-app/main/logo.png"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;link rel="icon" type="image/png"</p>
<p class="p1"><span class="Apple-converted-space">    </span>href="https://raw.githubusercontent.com/Domichico20/sheets-web-app/main/1%20logo.png?v=12"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;link rel="shortcut icon" type="image/png"</p>
<p class="p1"><span class="Apple-converted-space">    </span>href="https://raw.githubusercontent.com/Domichico20/sheets-web-app/main/1%20logo.png?v=12"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;link rel="apple-touch-icon" href="https://raw.githubusercontent.com/Domichico20/sheets-web-app/main/logo.png?v=6"&gt;</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;link rel="preconnect" href="https://fonts.googleapis.com"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;link rel="preconnect" href="https://fonts.gstatic.com" crossorigin&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;!-- speed: warm up API connections --&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;link rel="preconnect" href="https://sheets.googleapis.com" crossorigin&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;link rel="dns-prefetch" href="https://sheets.googleapis.com"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;link rel="preconnect" href="https://script.google.com" crossorigin&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;link rel="dns-prefetch" href="https://script.google.com"&gt;</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&amp;display=swap" rel="stylesheet"&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>* {</p>
<p class="p1"><span class="Apple-converted-space">      </span>margin: 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding: 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>box-sizing: border-box;</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-family: 'Poppins', Arial, sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>body {</p>
<p class="p1"><span class="Apple-converted-space">      </span>margin: 20px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>background-color: #f0f0f0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>header {</p>
<p class="p1"><span class="Apple-converted-space">      </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">      </span>margin-bottom: 20px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>position: relative;</p>
<p class="p1"><span class="Apple-converted-space">      </span>z-index: 2;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>header img.logo {</p>
<p class="p1"><span class="Apple-converted-space">      </span>max-width: 200px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>height: auto;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>h2 {</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-size: 1.75rem;</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-weight: 600;</p>
<p class="p1"><span class="Apple-converted-space">      </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">      </span>margin-bottom: 20px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>background: linear-gradient(90deg,</p>
<p class="p1"><span class="Apple-converted-space">          </span>#003366, #0066CC, #3399FF, #ff3333, #ffa733, #9a9c21, #54cc25, #1a8371, #229ea7, #33b4ff, #339cff);</p>
<p class="p1"><span class="Apple-converted-space">      </span>background-size: 200% auto;</p>
<p class="p1"><span class="Apple-converted-space">      </span>background-clip: text;</p>
<p class="p1"><span class="Apple-converted-space">      </span>-webkit-background-clip: text;</p>
<p class="p1"><span class="Apple-converted-space">      </span>-webkit-text-fill-color: transparent;</p>
<p class="p1"><span class="Apple-converted-space">      </span>animation: gradientShift 10s linear infinite;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>@media (prefers-reduced-motion: reduce) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>h2 {</p>
<p class="p1"><span class="Apple-converted-space">        </span>animation: none;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>@keyframes gradientShift {</p>
<p class="p1"><span class="Apple-converted-space">      </span>0% { background-position: 0% center; }</p>
<p class="p1"><span class="Apple-converted-space">      </span>100% { background-position: 200% center; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* --- Login section as a centered card --- */</p>
<p class="p1"><span class="Apple-converted-space">    </span>#loginSection {</p>
<p class="p1"><span class="Apple-converted-space">      </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">      </span>justify-content: center;</p>
<p class="p1"><span class="Apple-converted-space">      </span>align-items: flex-start;</p>
<p class="p1"><span class="Apple-converted-space">      </span>/* <span class="s1">⬅️</span> no vertical centering */</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding: 8px 16px 40px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>/* small top padding only */</p>
<p class="p1"><span class="Apple-converted-space">      </span>min-height: auto;</p>
<p class="p1"><span class="Apple-converted-space">      </span>/* <span class="s1">⬅️</span> remove forced height */</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.login-card { margin-top: 4px; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.login-card {</p>
<p class="p1"><span class="Apple-converted-space">      </span>position: relative;</p>
<p class="p1"><span class="Apple-converted-space">      </span>width: min(420px, 92vw);</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding: 28px 24px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>background: rgba(255, 255, 255, 0.92);</p>
<p class="p1"><span class="Apple-converted-space">      </span>border-radius: 16px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border: 1px solid rgba(0, 0, 0, 0.06);</p>
<p class="p1"><span class="Apple-converted-space">      </span>box-shadow: 0 20px 60px rgba(0, 0, 0, .15);</p>
<p class="p1"><span class="Apple-converted-space">      </span>backdrop-filter: blur(6px);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.login-card::before {</p>
<p class="p1"><span class="Apple-converted-space">      </span>content: "";</p>
<p class="p1"><span class="Apple-converted-space">      </span>position: absolute;</p>
<p class="p1"><span class="Apple-converted-space">      </span>inset: -2px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border-radius: inherit;</p>
<p class="p1"><span class="Apple-converted-space">      </span>background: linear-gradient(45deg,</p>
<p class="p1"><span class="Apple-converted-space">          </span>#FF0000, #FF7300, #FFFB00, #48FF00,</p>
<p class="p1"><span class="Apple-converted-space">          </span>#00FFD5, #002BFF, #FF00C8, #FF0000);</p>
<p class="p1"><span class="Apple-converted-space">      </span>background-size: 600%;</p>
<p class="p1"><span class="Apple-converted-space">      </span>filter: blur(14px);</p>
<p class="p1"><span class="Apple-converted-space">      </span>z-index: -1;</p>
<p class="p1"><span class="Apple-converted-space">      </span>opacity: .30;</p>
<p class="p1"><span class="Apple-converted-space">      </span>animation: glowRainbow 20s linear infinite;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.login-card .brand {</p>
<p class="p1"><span class="Apple-converted-space">      </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">      </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">      </span>gap: 10px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-weight: 700;</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-size: 1.25rem;</p>
<p class="p1"><span class="Apple-converted-space">      </span>margin-bottom: 14px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>color: #003366;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.inputbox { position: relative; margin: 12px 0 6px; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.inputbox input {</p>
<p class="p1"><span class="Apple-converted-space">      </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding: 14px 12px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-size: 1rem; /* &gt;=16px on most browsers =&gt; no iOS zoom */</p>
<p class="p1"><span class="Apple-converted-space">      </span>border: 1px solid #d6d6d6;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border-radius: 12px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>outline: none;</p>
<p class="p1"><span class="Apple-converted-space">      </span>background: #fff;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.inputbox label {</p>
<p class="p1"><span class="Apple-converted-space">      </span>position: absolute;</p>
<p class="p1"><span class="Apple-converted-space">      </span>left: 12px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>top: 50%;</p>
<p class="p1"><span class="Apple-converted-space">      </span>transform: translateY(-50%);</p>
<p class="p1"><span class="Apple-converted-space">      </span>background: #fff;</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding: 0 6px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>color: #666;</p>
<p class="p1"><span class="Apple-converted-space">      </span>pointer-events: none;</p>
<p class="p1"><span class="Apple-converted-space">      </span>transition: .18s ease;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.inputbox input:focus+label,</p>
<p class="p1"><span class="Apple-converted-space">    </span>.inputbox input:not(:placeholder-shown)+label {</p>
<p class="p1"><span class="Apple-converted-space">      </span>top: 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-size: .8rem;</p>
<p class="p1"><span class="Apple-converted-space">      </span>color: #003366;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* ========= Shared glow animation ========= */</p>
<p class="p1"><span class="Apple-converted-space">    </span>@keyframes glowRainbow {</p>
<p class="p1"><span class="Apple-converted-space">      </span>0% { background-position: 0 0; }</p>
<p class="p1"><span class="Apple-converted-space">      </span>50% { background-position: 400% 0; }</p>
<p class="p1"><span class="Apple-converted-space">      </span>100% { background-position: 0 0; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* Unlock button base */</p>
<p class="p1"><span class="Apple-converted-space">    </span>#loginSection .unlock-btn {</p>
<p class="p1"><span class="Apple-converted-space">      </span>margin-left: 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding: 15px 40px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border: none;</p>
<p class="p1"><span class="Apple-converted-space">      </span>outline: none;</p>
<p class="p1"><span class="Apple-converted-space">      </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">      </span>position: relative;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border-radius: 12px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>background-color: #2952db;</p>
<p class="p1"><span class="Apple-converted-space">      </span>color: #FFF;</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-size: 1.1rem;</p>
<p class="p1"><span class="Apple-converted-space">      </span>isolation: isolate;</p>
<p class="p1"><span class="Apple-converted-space">      </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">      </span>margin-top: 14px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* ====== Rest of your styles (unchanged) ====== */</p>
<p class="p1"><span class="Apple-converted-space">    </span>#searchSection {</p>
<p class="p1"><span class="Apple-converted-space">      </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">      </span>justify-content: center;</p>
<p class="p1"><span class="Apple-converted-space">      </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">      </span>margin-bottom: 20px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>#searchSection input[type="text"] {</p>
<p class="p1"><span class="Apple-converted-space">      </span>flex: 0 0 50%;</p>
<p class="p1"><span class="Apple-converted-space">      </span>max-width: 600px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding: 10px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-size: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border: 1px solid #d6d6d6;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border-radius: 12px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>#searchSection button.search-btn {</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding: 20px 40px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-size: 1.25rem;</p>
<p class="p1"><span class="Apple-converted-space">      </span>margin-left: 20px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>background-color: #92e67d;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border-radius: 12px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border: none;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.add-note-btn { background-color: #6934be; color: #fff; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.critical-btn { background-color: #fc933d; color: #fff; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.remove-alert-btn { background-color: #d93025; color: #fff; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.form-section {</p>
<p class="p1"><span class="Apple-converted-space">      </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">      </span>flex-wrap: wrap;</p>
<p class="p1"><span class="Apple-converted-space">      </span>gap: 20px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>margin-bottom: 20px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>justify-content: center;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.form-group { display: flex; flex-direction: column; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.form-group label { font-weight: bold; margin-bottom: 5px; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.form-group input {</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding: 10px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-size: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">      </span>width: 175px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border: 1px solid #d6d6d6;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border-radius: 12px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.button-row {</p>
<p class="p1"><span class="Apple-converted-space">      </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">      </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">      </span>justify-content: center; /* center the whole bar */</p>
<p class="p1"><span class="Apple-converted-space">      </span>margin: 20px 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.button-group.center {</p>
<p class="p1"><span class="Apple-converted-space">      </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">      </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">      </span>gap: 10px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>flex-wrap: nowrap; /* keep on one line */</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* If the screen is small, allow wrapping (optional) */</p>
<p class="p1"><span class="Apple-converted-space">    </span>@media (max-width: 700px) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>.button-group.center {</p>
<p class="p1"><span class="Apple-converted-space">        </span>flex-wrap: wrap;</p>
<p class="p1"><span class="Apple-converted-space">        </span>justify-content: center;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.button-group { display: flex; gap: 10px; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.button-group button {</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding: 20px 40px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-size: 1.25rem;</p>
<p class="p1"><span class="Apple-converted-space">      </span>color: white;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border: none;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border-radius: 12px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.add-btn<span class="Apple-converted-space">    </span>{ background-color: #003366; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.edit-btn <span class="Apple-converted-space">  </span>{ background-color: #3399FF; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.clear-btn<span class="Apple-converted-space">  </span>{ background-color: #66CC66; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.refresh-btn{ background-color: gold; color: black; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.delete-btn { background-color: red; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>table {</p>
<p class="p1"><span class="Apple-converted-space">      </span>margin: 0 auto;</p>
<p class="p1"><span class="Apple-converted-space">      </span>width: auto;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border-collapse: separate;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border-spacing: 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>background: white;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border-radius: 12px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>overflow: hidden;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>table th:nth-child(3),</p>
<p class="p1"><span class="Apple-converted-space">    </span>table td:nth-child(3) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>max-width: 250px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>overflow: hidden;</p>
<p class="p1"><span class="Apple-converted-space">      </span>text-overflow: ellipsis;</p>
<p class="p1"><span class="Apple-converted-space">      </span>white-space: nowrap;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>table th,</p>
<p class="p1"><span class="Apple-converted-space">    </span>table td {</p>
<p class="p1"><span class="Apple-converted-space">      </span>border: 1px solid #ccc;</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding: 8px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>text-align: left;</p>
<p class="p1"><span class="Apple-converted-space">      </span>white-space: nowrap;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>table th { background-color: #4285F4; color: white; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>tr.selected { background-color: rgb(238, 217, 217); }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* ========= SAME gradient glow for ALL buttons ========= */</p>
<p class="p1"><span class="Apple-converted-space">    </span>.button-group button,</p>
<p class="p1"><span class="Apple-converted-space">    </span>#searchSection .search-btn,</p>
<p class="p1"><span class="Apple-converted-space">    </span>#loginSection .unlock-btn {</p>
<p class="p1"><span class="Apple-converted-space">      </span>position: relative;</p>
<p class="p1"><span class="Apple-converted-space">      </span>isolation: isolate;</p>
<p class="p1"><span class="Apple-converted-space">      </span>z-index: 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.button-group button::before,</p>
<p class="p1"><span class="Apple-converted-space">    </span>#searchSection .search-btn::before,</p>
<p class="p1"><span class="Apple-converted-space">    </span>#loginSection .unlock-btn::before {</p>
<p class="p1"><span class="Apple-converted-space">      </span>content: "";</p>
<p class="p1"><span class="Apple-converted-space">      </span>position: absolute;</p>
<p class="p1"><span class="Apple-converted-space">      </span>inset: -2px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border-radius: inherit;</p>
<p class="p1"><span class="Apple-converted-space">      </span>background: linear-gradient(45deg,</p>
<p class="p1"><span class="Apple-converted-space">          </span>#FF0000, #FF7300, #FFFB00, #48FF00,</p>
<p class="p1"><span class="Apple-converted-space">          </span>#00FFD5, #002BFF, #FF00C8, #FF0000);</p>
<p class="p1"><span class="Apple-converted-space">      </span>background-size: 600%;</p>
<p class="p1"><span class="Apple-converted-space">      </span>filter: blur(8px);</p>
<p class="p1"><span class="Apple-converted-space">      </span>animation: glowRainbow 20s linear infinite;</p>
<p class="p1"><span class="Apple-converted-space">      </span>transition: opacity .3s ease-in-out;</p>
<p class="p1"><span class="Apple-converted-space">      </span>opacity: 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>z-index: -1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.button-group button:hover::before,</p>
<p class="p1"><span class="Apple-converted-space">    </span>#searchSection .search-btn:hover::before,</p>
<p class="p1"><span class="Apple-converted-space">    </span>#loginSection .unlock-btn:hover::before {</p>
<p class="p1"><span class="Apple-converted-space">      </span>opacity: 1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* --- Notes wrapping + scroll + WhatsApp link styling --- */</p>
<p class="p1"><span class="Apple-converted-space">    </span>table th:nth-child(7),</p>
<p class="p1"><span class="Apple-converted-space">    </span>table td:nth-child(7) { width: 550px; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.notes-cell {</p>
<p class="p1"><span class="Apple-converted-space">      </span>max-height: 180px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>overflow: auto;</p>
<p class="p1"><span class="Apple-converted-space">      </span>white-space: normal;</p>
<p class="p1"><span class="Apple-converted-space">      </span>line-height: 1.35;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.note-entry { margin: 0 0 .55em 0; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.note-entry .ts { font-weight: 100; color: #880000; font-size: 1.05rem; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* <span class="s1">🔴</span> Critical alert highlight */</p>
<p class="p1"><span class="Apple-converted-space">    </span>.note-entry.critical {</p>
<p class="p1"><span class="Apple-converted-space">      </span>background: #d93025; /* Google red */</p>
<p class="p1"><span class="Apple-converted-space">      </span>color: #fff;</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-weight: 700;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border-radius: 10px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding: 6px 10px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>display: inline-block;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>.phone-wa a { text-decoration: none; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* Make the Notes input wider */</p>
<p class="p1"><span class="Apple-converted-space">    </span>#notes { width: 500px; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* Optional: keep it fluid on small screens */</p>
<p class="p1"><span class="Apple-converted-space">    </span>@media (max-width: 600px) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>#notes { width: 100%; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* ===== Login-only background (uses bg.jpg) ===== */</p>
<p class="p1"><span class="Apple-converted-space">    </span>body.login-bg {</p>
<p class="p1"><span class="Apple-converted-space">      </span>min-height: 100vh;</p>
<p class="p1"><span class="Apple-converted-space">      </span>background: url('bg.jpg') center / cover no-repeat;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* subtle dark overlay to boost contrast behind the card */</p>
<p class="p1"><span class="Apple-converted-space">    </span>body.login-bg::before {</p>
<p class="p1"><span class="Apple-converted-space">      </span>content: "";</p>
<p class="p1"><span class="Apple-converted-space">      </span>position: fixed;</p>
<p class="p1"><span class="Apple-converted-space">      </span>inset: 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>background: rgba(0, 0, 0, .35);</p>
<p class="p1"><span class="Apple-converted-space">      </span>pointer-events: none;</p>
<p class="p1"><span class="Apple-converted-space">      </span>z-index: -1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* ===== App (2nd page) background ===== */</p>
<p class="p1"><span class="Apple-converted-space">    </span>body.app-bg {</p>
<p class="p1"><span class="Apple-converted-space">      </span>min-height: 100vh;</p>
<p class="p1"><span class="Apple-converted-space">      </span>background: url('https://raw.githubusercontent.com/Domichico20/sheets-web-app/main/pexels-codioful-6985045.jpg') center / cover no-repeat;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* Hide the app by default; only show it after login when body.app-bg is set */</p>
<p class="p1"><span class="Apple-converted-space">    </span>#appSection { display: none; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>body.app-bg #appSection { display: block; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* =========================================================</p>
<p class="p1"><span class="Apple-converted-space">       </span><span class="s1">✅</span> MOBILE + PERFORMANCE ADDITIONS (ONLY NEW STUFF BELOW)</p>
<p class="p1"><span class="Apple-converted-space">       </span>========================================================= */</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* Touch targets &amp; smoother taps */</p>
<p class="p1"><span class="Apple-converted-space">    </span>.button-group button,</p>
<p class="p1"><span class="Apple-converted-space">    </span>#searchSection .search-btn,</p>
<p class="p1"><span class="Apple-converted-space">    </span>#loginSection .unlock-btn {</p>
<p class="p1"><span class="Apple-converted-space">      </span>min-height: 44px; <span class="Apple-converted-space">            </span>/* thumb-friendly */</p>
<p class="p1"><span class="Apple-converted-space">      </span>will-change: transform; <span class="Apple-converted-space">      </span>/* (the line that was cut off) */</p>
<p class="p1"><span class="Apple-converted-space">      </span>-webkit-tap-highlight-color: transparent;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* Make the table paint faster and scroll nicely on mobile */</p>
<p class="p1"><span class="Apple-converted-space">    </span>#dataTable {</p>
<p class="p1"><span class="Apple-converted-space">      </span>content-visibility: auto; <span class="Apple-converted-space">                </span>/* paint only when visible */</p>
<p class="p1"><span class="Apple-converted-space">      </span>contain-intrinsic-size: 600px 400px;<span class="Apple-converted-space">      </span>/* reserve size for faster paint */</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>@media (max-width: 900px) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>body { margin: 10px; }</p>
<p class="p1"><span class="Apple-converted-space">      </span>header img.logo { max-width: 150px; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>@media (max-width: 768px) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>/* Stack the search bar */</p>
<p class="p1"><span class="Apple-converted-space">      </span>#searchSection {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>flex-direction: column;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>align-items: stretch;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>gap: 10px;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>#searchSection input[type="text"] {</p>
<p class="p1"><span class="Apple-converted-space">        </span>flex: 1 1 auto;</p>
<p class="p1"><span class="Apple-converted-space">        </span>max-width: none;</p>
<p class="p1"><span class="Apple-converted-space">        </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>#searchSection button.search-btn {</p>
<p class="p1"><span class="Apple-converted-space">        </span>margin-left: 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">        </span>padding: 14px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>font-size: 1.05rem;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>/* Inputs full-width in small screens */</p>
<p class="p1"><span class="Apple-converted-space">      </span>.form-group input { width: 100%; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>/* Button group wraps nicely */</p>
<p class="p1"><span class="Apple-converted-space">      </span>.button-group.center { flex-wrap: wrap; }</p>
<p class="p1"><span class="Apple-converted-space">      </span>.button-group.center button {</p>
<p class="p1"><span class="Apple-converted-space">        </span>flex: 1 1 48%;</p>
<p class="p1"><span class="Apple-converted-space">        </span>padding: 14px 16px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>font-size: 1rem;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>/* Table horizontal scroll instead of squeezing columns */</p>
<p class="p1"><span class="Apple-converted-space">      </span>table { width: 100%; }</p>
<p class="p1"><span class="Apple-converted-space">      </span>#dataTable {</p>
<p class="p1"><span class="Apple-converted-space">        </span>display: block;</p>
<p class="p1"><span class="Apple-converted-space">        </span>overflow-x: auto;</p>
<p class="p1"><span class="Apple-converted-space">        </span>-webkit-overflow-scrolling: touch;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>#dataTable thead,</p>
<p class="p1"><span class="Apple-converted-space">      </span>#dataTable tbody,</p>
<p class="p1"><span class="Apple-converted-space">      </span>#dataTable tr,</p>
<p class="p1"><span class="Apple-converted-space">      </span>#dataTable th,</p>
<p class="p1"><span class="Apple-converted-space">      </span>#dataTable td {</p>
<p class="p1"><span class="Apple-converted-space">        </span>white-space: nowrap;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>table th:nth-child(7),</p>
<p class="p1"><span class="Apple-converted-space">      </span>table td:nth-child(7) { width: auto; }</p>
<p class="p1"><span class="Apple-converted-space">      </span>.notes-cell { max-height: 120px; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>@media (max-width: 480px) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>.login-card { width: 100%; padding: 20px 16px; }</p>
<p class="p1"><span class="Apple-converted-space">      </span>.button-group.center button { flex-basis: 100%; }</p>
<p class="p1"><span class="Apple-converted-space">      </span>h2 { font-size: 1.25rem; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* Disable heavy glow/animation on phones &amp; reduced motion for snappier taps */</p>
<p class="p1"><span class="Apple-converted-space">    </span>@media (prefers-reduced-motion: reduce), (max-width: 768px) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>h2 { animation: none !important; }</p>
<p class="p1"><span class="Apple-converted-space">      </span>.button-group button::before,</p>
<p class="p1"><span class="Apple-converted-space">      </span>#searchSection .search-btn::before,</p>
<p class="p1"><span class="Apple-converted-space">      </span>#loginSection .unlock-btn::before,</p>
<p class="p1"><span class="Apple-converted-space">      </span>.login-card::before {</p>
<p class="p1"><span class="Apple-converted-space">        </span>display: none !important; <span class="Apple-converted-space">  </span>/* remove blurred gradient layer */</p>
<p class="p1"><span class="Apple-converted-space">        </span>animation: none !important;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">&lt;body&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;header&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;img src="https://raw.githubusercontent.com/Domichico20/sheets-web-app/main/logo.png" alt="Company Logo"</p>
<p class="p1"><span class="Apple-converted-space">      </span>class="logo" width="200" height="200" decoding="async" fetchpriority="high" referrerpolicy="no-referrer"</p>
<p class="p1"><span class="Apple-converted-space">      </span>onerror="this.onerror=null; this.src='https://raw.githubusercontent.com/Domichico20/sheets-web-app/main/1%20logo.png';"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/header&gt;</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div id="loginSection"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="login-card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;h1 class="brand"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;svg aria-hidden="true" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"</p>
<p class="p1"><span class="Apple-converted-space">          </span>style="margin-right:4px;color:#2952db"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;path</p>
<p class="p1"><span class="Apple-converted-space">            </span>d="M6 10V8a6 6 0 1112 0v2h1a1 1 0 011 1v10a1 1 0 01-1 1H5a1 1 0 01-1-1V11a1 1 0 011-1h1zm2 0h8V8a4 4 0 10-8 0v2z" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/svg&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>Osvaldo Nuñez</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/h1&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="inputbox"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;input type="password" id="appPassword" placeholder=" "</p>
<p class="p1"><span class="Apple-converted-space">          </span>onkeydown="if(event.key==='Enter'){event.preventDefault();checkPassword();}"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;label for="appPassword"&gt;Enter Password&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="unlock-btn" onclick="checkPassword()"&gt;Unlock&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;!-- App UI: hidden by CSS until body gets class 'app-bg' after login --&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div id="appSection"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;form id="searchForm" onsubmit="event.preventDefault(); searchData();"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div id="searchSection"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;input type="text" id="searchQuery" placeholder="Search by username, phone, or email"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button type="submit" class="search-btn"&gt;Search&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/form&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="form-section"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="form-group"&gt;&lt;label for="username"&gt;Username:&lt;/label&gt;&lt;input type="text" id="username"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="form-group"&gt;&lt;label for="password"&gt;Password:&lt;/label&gt;&lt;input type="text" id="password"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="form-group"&gt;&lt;label for="email"&gt;Email:&lt;/label&gt;&lt;input type="text" id="email"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="form-group"&gt;&lt;label for="phone"&gt;Phone #:&lt;/label&gt;&lt;input type="text" id="phone"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="form-group"&gt;&lt;label for="server"&gt;Server:&lt;/label&gt;&lt;input type="text" id="server"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="form-group"&gt;&lt;label for="autoPay"&gt;AutoPay:&lt;/label&gt;&lt;input type="text" id="autoPay"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="form-group"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;label for="notes"&gt;Notes:&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;input type="text" id="notes"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;input type="hidden" id="rowIndex" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="button-row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="button-group center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button class="add-btn" onclick="addRow()"&gt;Add&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button class="edit-btn" onclick="confirmEdit()"&gt;Edit&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button class="clear-btn" onclick="clearForm()"&gt;Clear&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button class="refresh-btn" onclick="loadData(true)"&gt;Refresh&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button class="delete-btn" onclick="confirmDelete()"&gt;Delete&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button type="button" class="add-note-btn" onclick="addNewNote()"&gt;Add New Note&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button type="button" class="critical-btn" onclick="addCriticalAlert()"&gt;Add Critical Alert&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button type="button" class="remove-alert-btn" onclick="removeCriticalAlert()"&gt;Remove Alert&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;table id="dataTable"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;thead&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;th&gt;Username&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;th&gt;Password&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;th&gt;Email&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;th&gt;Phone&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;th&gt;Server&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;th&gt;AutoPay&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;th&gt;Notes&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/thead&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;tbody&gt;&lt;/tbody&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/table&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>/* ---------- Login background on first load ---------- */</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.addEventListener('DOMContentLoaded', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>document.body.classList.add('login-bg');</p>
<p class="p1"><span class="Apple-converted-space">      </span>initDOMCache(); // Initialize DOM cache for performance</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* ---------- App constants ---------- */</p>
<p class="p1"><span class="Apple-converted-space">    </span>const ROW_LIMIT = 25;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const scriptURL = 'https://script.google.com/macros/s/AKfycbzB8lRPMU0nZRSoU6CoRL_fcYstdq9pWPeZKdwuSp6O0QSsa95Oh49UnfV6uB9wt9w/exec';</p>
<p class="p1"><span class="Apple-converted-space">    </span>const sheetId = '1IR2TT4isrhET-3krSHV1BC8mE6xAhy0MEnR0h5-xBzs';</p>
<p class="p1"><span class="Apple-converted-space">    </span>const apiKey = 'AIzaSyC5rmJA1nl0LRhbGe-TsZwOSBfP97SzsHk';</p>
<p class="p1"><span class="Apple-converted-space">    </span>const range = 'data!A1:G3000';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>let sessionPassword = "";</p>
<p class="p1"><span class="Apple-converted-space">    </span>let selectedRowIndex = null; <span class="Apple-converted-space">  </span>// 1-based sheet row</p>
<p class="p1"><span class="Apple-converted-space">    </span>let selectedRawNotes = '';</p>
<p class="p1"><span class="Apple-converted-space">    </span>let existingUsernames = [];</p>
<p class="p1"><span class="Apple-converted-space">    </span>let allRecords = []; <span class="Apple-converted-space">          </span>// { row:[...], sheetRow:Number, lastEditMs:Number }</p>
<p class="p1"><span class="Apple-converted-space">    </span>let totalRows = 0;</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Performance optimization: Cache DOM elements</p>
<p class="p1"><span class="Apple-converted-space">    </span>const domCache = {</p>
<p class="p1"><span class="Apple-converted-space">      </span>searchQuery: null,</p>
<p class="p1"><span class="Apple-converted-space">      </span>username: null,</p>
<p class="p1"><span class="Apple-converted-space">      </span>password: null,</p>
<p class="p1"><span class="Apple-converted-space">      </span>email: null,</p>
<p class="p1"><span class="Apple-converted-space">      </span>phone: null,</p>
<p class="p1"><span class="Apple-converted-space">      </span>server: null,</p>
<p class="p1"><span class="Apple-converted-space">      </span>autoPay: null,</p>
<p class="p1"><span class="Apple-converted-space">      </span>notes: null,</p>
<p class="p1"><span class="Apple-converted-space">      </span>dataTable: null,</p>
<p class="p1"><span class="Apple-converted-space">      </span>tbody: null</p>
<p class="p1"><span class="Apple-converted-space">    </span>};</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Initialize DOM cache</p>
<p class="p1"><span class="Apple-converted-space">    </span>function initDOMCache() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>domCache.searchQuery = document.getElementById('searchQuery');</p>
<p class="p1"><span class="Apple-converted-space">      </span>domCache.username = document.getElementById('username');</p>
<p class="p1"><span class="Apple-converted-space">      </span>domCache.password = document.getElementById('password');</p>
<p class="p1"><span class="Apple-converted-space">      </span>domCache.email = document.getElementById('email');</p>
<p class="p1"><span class="Apple-converted-space">      </span>domCache.phone = document.getElementById('phone');</p>
<p class="p1"><span class="Apple-converted-space">      </span>domCache.server = document.getElementById('server');</p>
<p class="p1"><span class="Apple-converted-space">      </span>domCache.autoPay = document.getElementById('autoPay');</p>
<p class="p1"><span class="Apple-converted-space">      </span>domCache.notes = document.getElementById('notes');</p>
<p class="p1"><span class="Apple-converted-space">      </span>domCache.dataTable = document.getElementById('dataTable');</p>
<p class="p1"><span class="Apple-converted-space">      </span>domCache.tbody = document.querySelector('#dataTable tbody');</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Debounce search to prevent excessive calls</p>
<p class="p1"><span class="Apple-converted-space">    </span>let searchTimeout = null;</p>
<p class="p1"><span class="Apple-converted-space">    </span>function debounceSearch(func, delay = 300) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>return function(...args) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>clearTimeout(searchTimeout);</p>
<p class="p1"><span class="Apple-converted-space">        </span>searchTimeout = setTimeout(() =&gt; func.apply(this, args), delay);</p>
<p class="p1"><span class="Apple-converted-space">      </span>};</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Request cache to prevent duplicate API calls</p>
<p class="p1"><span class="Apple-converted-space">    </span>const requestCache = new Map();</p>
<p class="p1"><span class="Apple-converted-space">    </span>const CACHE_DURATION = 5000; // 5 seconds</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>function getCachedRequest(url) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const cached = requestCache.get(url);</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (cached &amp;&amp; Date.now() - cached.timestamp &lt; CACHE_DURATION) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>return cached.data;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>return null;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><span class="Apple-converted-space">    </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>function setCachedRequest(url, data) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>requestCache.set(url, {</p>
<p class="p1"><span class="Apple-converted-space">        </span>data: data,</p>
<p class="p1"><span class="Apple-converted-space">        </span>timestamp: Date.now()</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// speed helper: disable/enable a button by selector (prevents double submits)</p>
<p class="p1"><span class="Apple-converted-space">    </span>function setBusy(selector, on) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const btn = document.querySelector(selector);</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (btn) btn.disabled = !!on;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* ---------- Login ---------- */</p>
<p class="p1"><span class="Apple-converted-space">    </span>function checkPassword() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const pass = document.getElementById('appPassword').value.trim();</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (pass === 'Google#2020') {</p>
<p class="p1"><span class="Apple-converted-space">        </span>sessionPassword = pass;</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.body.classList.remove('login-bg');</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.body.classList.add('app-bg');</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('loginSection').style.display = 'none';</p>
<p class="p1"><span class="Apple-converted-space">        </span>loadData();</p>
<p class="p1"><span class="Apple-converted-space">      </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">        </span>alert('Incorrect password');</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>window.checkPassword = checkPassword; // keep inline onclick working</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* ---------- Helpers (formatting + search) ---------- */</p>
<p class="p1"><span class="Apple-converted-space">    </span>const TS_REGEX = /^(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{1,2},\s\d{4},?\s\d{2}:\d{2}\s(?:AM|PM)/;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>function parseLastEditMs(notesCell) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!notesCell) return 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const firstLine = String(notesCell).split('\n')[0].trim();</p>
<p class="p1"><span class="Apple-converted-space">      </span>const m = firstLine.match(TS_REGEX);</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!m) return 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const ms = Date.parse(m[0]);</p>
<p class="p1"><span class="Apple-converted-space">      </span>return isNaN(ms) ? 0 : ms;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>function escapeHTML(s) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>return String(s ?? '').replace(/[&amp;&lt;&gt;"']/g, c =&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>({ '&amp;': '&amp;amp;', '&lt;': '&amp;lt;', '&gt;': '&amp;gt;', '"': '&amp;quot;', "'": '&amp;#39;' }[c]));</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>function normalizePhone(s) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const d = (s || '').replace(/\D/g, '');</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (d.length === 10) return d.replace(/(\d{3})(\d{3})(\d{4})/, '($1) $2-$3');</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (d.length === 11 &amp;&amp; d.startsWith('1'))</p>
<p class="p1"><span class="Apple-converted-space">        </span>return d.replace(/^1(\d{3})(\d{3})(\d{4})/, '1 ($1) $2-$3');</p>
<p class="p1"><span class="Apple-converted-space">      </span>return s || '';</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>function digitsOnly(s) { return (s || '').replace(/\D/g, ''); }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>function phoneLink(s) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const d = digitsOnly(s);</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!d) return '';</p>
<p class="p1"><span class="Apple-converted-space">      </span>const wa = (d.length === 10) ? ('1' + d) : (d.length === 11 &amp;&amp; d.startsWith('1') ? d : d);</p>
<p class="p1"><span class="Apple-converted-space">      </span>const display = normalizePhone(s);</p>
<p class="p1"><span class="Apple-converted-space">      </span>return `&lt;a href="https://wa.me/${wa}" target="_blank" rel="noopener" title="Message on WhatsApp"&gt;${escapeHTML(display)} <span class="s1">📲</span>&lt;/a&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>function canonicalEmail(s) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>return (s || '')</p>
<p class="p1"><span class="Apple-converted-space">        </span>.toLowerCase()</p>
<p class="p1"><span class="Apple-converted-space">        </span>.replace(/^mailto:\s*/, '')</p>
<p class="p1"><span class="Apple-converted-space">        </span>.replace(/^mail\s*to:\s*/, '')</p>
<p class="p1"><span class="Apple-converted-space">        </span>.replace(/\s+/g, '')</p>
<p class="p1"><span class="Apple-converted-space">        </span>.trim();</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>function formatNotes(cell) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const stripped = (cell || '').replace(/#\d+:\s*/g, '').trim();</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!stripped) return '';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Render line by line so we can style CRITICAL alerts too</p>
<p class="p1"><span class="Apple-converted-space">      </span>const lines = stripped.split('\n');</p>
<p class="p1"><span class="Apple-converted-space">      </span>return lines</p>
<p class="p1"><span class="Apple-converted-space">        </span>.map(line =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">          </span>// <span class="s1">🔴</span> Critical alert line</p>
<p class="p1"><span class="Apple-converted-space">          </span>const c = line.match(/^\[CRITICAL_ALERT\]\s*(.*)$/);</p>
<p class="p1"><span class="Apple-converted-space">          </span>if (c) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const msg = c[1] || '';</p>
<p class="p1"><span class="Apple-converted-space">            </span>return `&lt;div class="note-entry critical"&gt;CRITICAL ALERT: ${escapeHTML(msg)}&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">          </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">          </span>// Normal timestamped note line</p>
<p class="p1"><span class="Apple-converted-space">          </span>const m = line.match(/^((?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{1,2},\s\d{4},?\s\d{2}:\d{2}\s(?:AM|PM)):\s*(.*)$/);</p>
<p class="p1"><span class="Apple-converted-space">          </span>if (!m) return `&lt;div class="note-entry"&gt;&lt;span class="txt"&gt;${escapeHTML(line)}&lt;/span&gt;&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">          </span>return `&lt;div class="note-entry"&gt;&lt;span class="ts"&gt;${escapeHTML(m[1])}&lt;/span&gt;: &lt;span class="txt"&gt;${escapeHTML(m[2])}&lt;/span&gt;&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>})</p>
<p class="p1"><span class="Apple-converted-space">        </span>.join('');</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* helper: show CRITICAL alert notification without auto-delete */</p>
<p class="p1"><span class="Apple-converted-space">    </span>function showCriticalAlert(rec) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const noteCell = (rec &amp;&amp; rec.row &amp;&amp; rec.row[6]) ? rec.row[6] : '';</p>
<p class="p1"><span class="Apple-converted-space">      </span>const m = (noteCell || '').match(/\[CRITICAL_ALERT\]\s*(.+)/);</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!m) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>const message = m[1].trim();</p>
<p class="p1"><span class="Apple-converted-space">      </span>// Just show the alert without prompting for deletion</p>
<p class="p1"><span class="Apple-converted-space">      </span>setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>alert(`<span class="s1">⚠️</span> CRITICAL ALERT\n\n${message}\n\nThis alert will remain until manually removed.`);</p>
<p class="p1"><span class="Apple-converted-space">      </span>}, 100);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* ---------- Table cell renderer (restores your look) ---------- */</p>
<p class="p1"><span class="Apple-converted-space">    </span>function tdHTML(row) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>return row.map((cell, ci) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (ci === 6) return '&lt;td&gt;&lt;div class="notes-cell"&gt;' + formatNotes(cell) + '&lt;/div&gt;&lt;/td&gt;'; // Notes</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (ci === 3) return '&lt;td class="phone-wa"&gt;' + phoneLink(cell) + '&lt;/td&gt;'; <span class="Apple-converted-space">                </span>// Phone</p>
<p class="p1"><span class="Apple-converted-space">        </span>return '&lt;td&gt;' + escapeHTML(cell) + '&lt;/td&gt;';</p>
<p class="p1"><span class="Apple-converted-space">      </span>}).join('');</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>/* helper: show CRITICAL alert notification without auto-delete */</p>
<p class="p1"><span class="Apple-converted-space">    </span>function showCriticalAlert(rec) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const noteCell = (rec &amp;&amp; rec.row &amp;&amp; rec.row[6]) ? rec.row[6] : '';</p>
<p class="p1"><span class="Apple-converted-space">      </span>const m = (noteCell || '').match(/\[CRITICAL_ALERT\]\s*(.+)/);</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!m) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>const message = m[1].trim();</p>
<p class="p1"><span class="Apple-converted-space">      </span>// Just show the alert without prompting for deletion</p>
<p class="p1"><span class="Apple-converted-space">      </span>setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>alert(`<span class="s1">⚠️</span> CRITICAL ALERT\n\n${message}\n\nThis alert will remain until manually removed.`);</p>
<p class="p1"><span class="Apple-converted-space">      </span>}, 100);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* ---------- Data load + render ---------- */</p>
<p class="p1"><span class="Apple-converted-space">    </span>function renderTable(records){</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (!domCache.tbody) return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>domCache.tbody.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">  </span>const frag = document.createDocumentFragment();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>records.forEach(rec =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const row = rec.row;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const tr = document.createElement('tr');</p>
<p class="p1"><span class="Apple-converted-space">    </span>tr.innerHTML = tdHTML(row);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>tr.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>selectedRowIndex = rec.sheetRow; // exact sheet row for edit/delete</p>
<p class="p1"><span class="Apple-converted-space">      </span>document.querySelectorAll('#dataTable tr.selected').forEach(r =&gt; r.classList.remove('selected'));</p>
<p class="p1"><span class="Apple-converted-space">      </span>tr.classList.add('selected');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Use cached DOM elements for better performance</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (domCache.username) domCache.username.value = row[0] || '';</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (domCache.password) domCache.password.value = row[1] || '';</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (domCache.email) domCache.email.value = row[2] || '';</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (domCache.phone) domCache.phone.value = row[3] || '';</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (domCache.server) domCache.server.value = row[4] || '';</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (domCache.autoPay) domCache.autoPay.value = row[5] || '';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>selectedRawNotes = row[6] || '';</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (domCache.notes) domCache.notes.value = '';</p>
<p class="p1"><span class="Apple-converted-space">      </span>const idxEl = document.getElementById('rowIndex');</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (idxEl) idxEl.value = selectedRowIndex;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Show critical alert (guarded)</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (typeof showCriticalAlert === 'function') {</p>
<p class="p1"><span class="Apple-converted-space">        </span>try { showCriticalAlert(rec); } catch (e) { console.warn('Alert show error:', e); }</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>frag.appendChild(tr);</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>domCache.tbody.appendChild(frag);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">   </span>// Tunables</p>
<p class="p1">const REFRESH_COLS = 'A:G';</p>
<p class="p1">const SHEET_TAB<span class="Apple-converted-space">    </span>= 'data';</p>
<p class="p2"><br></p>
<p class="p1">// Safe busy helper (does nothing if not present)</p>
<p class="p1">function setBusySafe(sel, on) {</p>
<p class="p1"><span class="Apple-converted-space">  </span>const el = document.querySelector(sel);</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (!el) return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>el.disabled = !!on;</p>
<p class="p1"><span class="Apple-converted-space">  </span>el.style.opacity = on ? .6 : 1;</p>
<p class="p1"><span class="Apple-converted-space">  </span>el.style.pointerEvents = on ? 'none' : 'auto';</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// Optimized sort helper with better performance</p>
<p class="p1">function sortByRecent(a, b) {</p>
<p class="p1"><span class="Apple-converted-space">  </span>// Use bitwise operations for faster comparison</p>
<p class="p1"><span class="Apple-converted-space">  </span>const timeDiff = b.lastEditMs - a.lastEditMs;</p>
<p class="p1"><span class="Apple-converted-space">  </span>return timeDiff !== 0 ? timeDiff : (b.sheetRow - a.sheetRow);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// Optimized sorting for large datasets</p>
<p class="p1">function sortRecords(records) {</p>
<p class="p1"><span class="Apple-converted-space">  </span>// Use native sort with optimized comparison</p>
<p class="p1"><span class="Apple-converted-space">  </span>return records.sort(sortByRecent);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// Build the inner &lt;td&gt; HTML for a row (preserve WhatsApp link + notes formatting)</p>
<p class="p1">function tdHTML(rowArr) {</p>
<p class="p1"><span class="Apple-converted-space">  </span>return rowArr.map((cell, ci) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (ci === 6) return '&lt;td&gt;&lt;div class="notes-cell"&gt;' + formatNotes(cell) + '&lt;/div&gt;&lt;/td&gt;'; // Notes</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (ci === 3) return '&lt;td class="phone-wa"&gt;' + phoneLink(cell) + '&lt;/td&gt;'; <span class="Apple-converted-space">                </span>// Phone -&gt; WhatsApp link</p>
<p class="p1"><span class="Apple-converted-space">    </span>return '&lt;td&gt;' + escapeHTML(cell) + '&lt;/td&gt;';</p>
<p class="p1"><span class="Apple-converted-space">  </span>}).join('');</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">// Fetch and update a set of sheet rows via one batchGet</p>
<p class="p1">async function refreshRowsBatch(sheetRowNums) {</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (!sheetRowNums.length) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const ranges = sheetRowNums.map(r =&gt; `${SHEET_TAB}!${REFRESH_COLS.split(':')[0]}${r}:${REFRESH_COLS.split(':')[1]}${r}`);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const qs = ranges.map(r =&gt; `ranges=${encodeURIComponent(r)}`).join('&amp;');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values:batchGet?${qs}&amp;fields=valueRanges(range,values)&amp;key=${apiKey}`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const res = await fetch(url);</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (!res.ok) throw new Error(`HTTP ${res.status}`);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const payload = await res.json();</p>
<p class="p1"><span class="Apple-converted-space">  </span>const list = (payload &amp;&amp; payload.valueRanges) || [];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Map “A123:G123” -&gt; 123</p>
<p class="p1"><span class="Apple-converted-space">  </span>const rowNumFromRange = (rng) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const m = String(rng || '').match(/!.*?([A-Z]+)(\d+):/i);</p>
<p class="p1"><span class="Apple-converted-space">    </span>return m ? parseInt(m[2], 10) : null;</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>list.forEach(vr =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const rnum = rowNumFromRange(vr.range);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!rnum) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const row = (vr.values &amp;&amp; vr.values[0]) ? vr.values[0] : [];</p>
<p class="p1"><span class="Apple-converted-space">    </span>const newRow = [0,1,2,3,4,5,6].map(i =&gt; row[i] || '');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// update selected notes cache if applicable</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (typeof selectedRowIndex === 'number' &amp;&amp; rnum === selectedRowIndex) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>selectedRawNotes = newRow[6] || '';</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// upsert into allRecords</p>
<p class="p1"><span class="Apple-converted-space">    </span>let rec = allRecords.find(x =&gt; x.sheetRow === rnum);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (rec) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>rec.row = newRow;</p>
<p class="p1"><span class="Apple-converted-space">      </span>rec.lastEditMs = Date.now(); // treat as latest change</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">      </span>rec = {</p>
<p class="p1"><span class="Apple-converted-space">        </span>row: newRow,</p>
<p class="p1"><span class="Apple-converted-space">        </span>sheetRow: rnum,</p>
<p class="p1"><span class="Apple-converted-space">        </span>lastEditMs: parseLastEditMs(newRow[6] || '') || Date.now()</p>
<p class="p1"><span class="Apple-converted-space">      </span>};</p>
<p class="p1"><span class="Apple-converted-space">      </span>allRecords.push(rec);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// update DOM cell contents if this row is currently rendered</p>
<p class="p1"><span class="Apple-converted-space">    </span>const tr = document.querySelector(`#dataTable tbody tr[data-row="${rnum}"]`);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (tr) tr.innerHTML = tdHTML(newRow);</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// Full reload (reduced payload using fields=values)</p>
<p class="p1">async function fullReload() {</p>
<p class="p1"><span class="Apple-converted-space">  </span>const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${encodeURIComponent(range)}?fields=values&amp;key=${apiKey}`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const r = await fetch(url);</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (!r.ok) throw new Error(`HTTP ${r.status}`);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const data = await r.json();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const rows = data.values || [];</p>
<p class="p1"><span class="Apple-converted-space">  </span>totalRows = rows.length;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const dataRows = rows.slice(1); // skip header</p>
<p class="p1"><span class="Apple-converted-space">  </span>existingUsernames = dataRows.map(r =&gt; (r[0] || '').toLowerCase());</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>allRecords = dataRows.map((row, idx) =&gt; ({</p>
<p class="p1"><span class="Apple-converted-space">    </span>row,</p>
<p class="p1"><span class="Apple-converted-space">    </span>sheetRow: idx + 2, // 1-based + header</p>
<p class="p1"><span class="Apple-converted-space">    </span>lastEditMs: parseLastEditMs(row[6] || '')</p>
<p class="p1"><span class="Apple-converted-space">  </span>}));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>sortRecords(allRecords);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>if (domCache.searchQuery) domCache.searchQuery.value = '';</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (domCache.tbody) domCache.tbody.innerHTML = '';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>renderTable(allRecords.slice(0, ROW_LIMIT));</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// === Optimized loader ===</p>
<p class="p1">// - onlySelected === true -&gt; refresh selected row if any,</p>
<p class="p1">// <span class="Apple-converted-space">  </span>otherwise refresh all VISIBLE rows (no selection required).</p>
<p class="p1">// - onlySelected === false -&gt; full reload (lightweight payload).</p>
<p class="p1">async function loadData(onlySelected = false) {</p>
<p class="p1"><span class="Apple-converted-space">  </span>setBusySafe('#refreshBtn', true);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>try {</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (onlySelected) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>let targets = [];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// If a row is selected, prefer that…</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (Number.isInteger(selectedRowIndex)) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>targets = [selectedRowIndex];</p>
<p class="p1"><span class="Apple-converted-space">      </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">        </span>// …otherwise grab all rows currently rendered in the table</p>
<p class="p1"><span class="Apple-converted-space">        </span>targets = Array.from(document.querySelectorAll('#dataTable tbody tr'))</p>
<p class="p1"><span class="Apple-converted-space">          </span>.map(tr =&gt; parseInt(tr.dataset.row, 10))</p>
<p class="p1"><span class="Apple-converted-space">          </span>.filter(Boolean);</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Fallback to top chunk if table is empty (e.g., first load)</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (targets.length === 0 &amp;&amp; Array.isArray(allRecords) &amp;&amp; allRecords.length) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>targets = allRecords.slice(0, ROW_LIMIT).map(r =&gt; r.sheetRow);</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>if (targets.length) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>await refreshRowsBatch(Array.from(new Set(targets)));</p>
<p class="p1"><span class="Apple-converted-space">        </span>// keep table sorted by latest change, then show top chunk (fast)</p>
<p class="p1"><span class="Apple-converted-space">        </span>sortRecords(allRecords);</p>
<p class="p1"><span class="Apple-converted-space">        </span>renderTable(allRecords.slice(0, ROW_LIMIT));</p>
<p class="p1"><span class="Apple-converted-space">        </span>return;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>// If we still have nothing, do a full reload.</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>await fullReload();</p>
<p class="p1"><span class="Apple-converted-space">  </span>} catch (err) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>console.error(err);</p>
<p class="p1"><span class="Apple-converted-space">    </span>alert('Failed to load data from Google Sheets.');</p>
<p class="p1"><span class="Apple-converted-space">  </span>} finally {</p>
<p class="p1"><span class="Apple-converted-space">    </span>setBusySafe('#refreshBtn', false);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">window.loadData = loadData;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* ---------- Search (optimized with caching and debouncing) ---------- */</p>
<p class="p1">function searchData() {</p>
<p class="p1"><span class="Apple-converted-space">  </span>const raw = domCache.searchQuery.value.trim().toLowerCase();</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (!raw) {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>renderTable(allRecords.slice(0, ROW_LIMIT));<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>return;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Pre-compile regex patterns for better performance</p>
<p class="p1"><span class="Apple-converted-space">  </span>const qDigits = (raw.match(/\d/g) || []).join('');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const qEmail = canonicalEmail(raw);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const hasPhoneQuery = qDigits.length &gt;= 7;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const hasEmailQuery = qEmail.includes('@');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Use for loop instead of filter for better performance on large datasets</p>
<p class="p1"><span class="Apple-converted-space">  </span>const filtered = [];</p>
<p class="p1"><span class="Apple-converted-space">  </span>for (let i = 0; i &lt; allRecords.length; i++) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const rec = allRecords[i];</p>
<p class="p1"><span class="Apple-converted-space">    </span>const row = rec.row;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const baseMatch = row.join(' ').toLowerCase().includes(raw);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>let phoneMatch = false;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (hasPhoneQuery) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const rp = (row[3] || '').replace(/\D/g, '');</p>
<p class="p1"><span class="Apple-converted-space">      </span>const last10 = s =&gt; s.slice(-10);</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (rp) phoneMatch = rp.includes(qDigits) || last10(rp) === last10(qDigits);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>let emailMatch = false;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (hasEmailQuery) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const re = canonicalEmail(row[2] || '');</p>
<p class="p1"><span class="Apple-converted-space">      </span>emailMatch = re.includes(qEmail);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>if (baseMatch || phoneMatch || emailMatch) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>filtered.push(rec);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>renderTable(filtered.slice(0, ROW_LIMIT));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// If the search narrows to exactly one row and it has a CRITICAL alert, show it immediately</p>
<p class="p1"><span class="Apple-converted-space">  </span>// After rendering, if any matching row has a CRITICAL alert, show once.</p>
<p class="p1"><span class="Apple-converted-space">  </span>const alertRec = filtered.find(r =&gt; /\[CRITICAL_ALERT\]/.test((r.row[6] || '')));</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (alertRec) { showCriticalAlert(alertRec); }</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// Create debounced version of search</p>
<p class="p1">const debouncedSearch = debounceSearch(searchData, 300);</p>
<p class="p1">window.searchData = searchData;</p>
<p class="p1">window.debouncedSearch = debouncedSearch;</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>/* ---------- Add/Edit/Delete (same behavior as before) ---------- */</p>
<p class="p1"><span class="Apple-converted-space">      </span>function clearForm() {</p>
<p class="p1"><span class="Apple-converted-space">        </span>// Use cached DOM elements for better performance</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (domCache.username) domCache.username.value = '';</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (domCache.password) domCache.password.value = '';</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (domCache.email) domCache.email.value = '';</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (domCache.phone) domCache.phone.value = '';</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (domCache.server) domCache.server.value = '';</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (domCache.autoPay) domCache.autoPay.value = '';</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (domCache.notes) domCache.notes.value = '';</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (domCache.searchQuery) domCache.searchQuery.value = '';</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>document.querySelectorAll('#dataTable tr.selected').forEach(r =&gt; r.classList.remove('selected'));</p>
<p class="p1"><span class="Apple-converted-space">        </span>selectedRowIndex = null;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>window.clearForm = clearForm;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>function confirmDelete() {</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (selectedRowIndex === null) { alert('Select a row first.'); return; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!confirm('Delete selected row?')) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>setBusy('.delete-btn', true);</p>
<p class="p1"><span class="Apple-converted-space">        </span>fetch(scriptURL, {</p>
<p class="p1"><span class="Apple-converted-space">          </span>method: 'POST',</p>
<p class="p1"><span class="Apple-converted-space">          </span>body: new URLSearchParams({ action: 'delete', password: sessionPassword, row: selectedRowIndex })</p>
<p class="p1"><span class="Apple-converted-space">        </span>})</p>
<p class="p1"><span class="Apple-converted-space">          </span>.then(res =&gt; res.text())</p>
<p class="p1"><span class="Apple-converted-space">          </span>.then(() =&gt; { selectedRowIndex = null; loadData(); })</p>
<p class="p1"><span class="Apple-converted-space">          </span>.catch(err =&gt; alert('Delete failed: ' + err))</p>
<p class="p1"><span class="Apple-converted-space">          </span>.finally(() =&gt; setBusy('.delete-btn', false));</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>window.confirmDelete = confirmDelete;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>function confirmEdit() {</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (selectedRowIndex === null) { alert('Select a row first!'); return; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!confirm('Save changes to this row?')) return;</p>
<p class="p1"><span class="Apple-converted-space">        </span>editRow();</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>window.confirmEdit = confirmEdit;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>function editRow() {</p>
<p class="p1"><span class="Apple-converted-space">  </span>setBusy('.edit-btn', true);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Use cached DOM elements for better performance</p>
<p class="p1"><span class="Apple-converted-space">  </span>const rawNew = domCache.notes ? domCache.notes.value.trim() : '';</p>
<p class="p1"><span class="Apple-converted-space">  </span>const existing = (selectedRawNotes || '').replace(/#\d+:\s*/g, '').trim();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>let combined = existing;</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (rawNew) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const ts = new Date().toLocaleString('en-US', {</p>
<p class="p1"><span class="Apple-converted-space">      </span>timeZone: 'America/Chicago', // match server timezone used on Adds</p>
<p class="p1"><span class="Apple-converted-space">      </span>month: 'short', day: 'numeric', year: 'numeric',</p>
<p class="p1"><span class="Apple-converted-space">      </span>hour: '2-digit', minute: '2-digit'</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>combined = `${ts}: ${rawNew}` + (existing ? `\n${existing}` : '');</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const params = new URLSearchParams({</p>
<p class="p1"><span class="Apple-converted-space">    </span>action: 'edit',</p>
<p class="p1"><span class="Apple-converted-space">    </span>password: sessionPassword,</p>
<p class="p1"><span class="Apple-converted-space">    </span>row: selectedRowIndex,</p>
<p class="p1"><span class="Apple-converted-space">    </span>username: domCache.username ? domCache.username.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">    </span>passwordField: domCache.password ? domCache.password.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">    </span>email: domCache.email ? domCache.email.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">    </span>phone: normalizePhone(domCache.phone ? domCache.phone.value.trim() : ''),</p>
<p class="p1"><span class="Apple-converted-space">    </span>server: domCache.server ? domCache.server.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">    </span>autoPay: domCache.autoPay ? domCache.autoPay.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">    </span>notes: combined</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// <span class="s1">✅</span> Post the edit, then refresh THIS row from Google Sheets (server truth),</p>
<p class="p1"><span class="Apple-converted-space">  </span>// <span class="s1">✅</span> mark it as latest change, resort, and re-render.</p>
<p class="p1"><span class="Apple-converted-space">  </span>fetch(scriptURL, { method: 'POST', body: params })</p>
<p class="p1"><span class="Apple-converted-space">    </span>.then(r =&gt; r.text())</p>
<p class="p1"><span class="Apple-converted-space">    </span>.then(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const singleRange = `data!A${selectedRowIndex}:G${selectedRowIndex}`;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${encodeURIComponent(singleRange)}?key=${apiKey}`;</p>
<p class="p1"><span class="Apple-converted-space">      </span>return fetch(url).then(res =&gt; res.json());</p>
<p class="p1"><span class="Apple-converted-space">    </span>})</p>
<p class="p1"><span class="Apple-converted-space">    </span>.then(data =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const row = (data &amp;&amp; data.values &amp;&amp; data.values[0]) ? data.values[0] : [];</p>
<p class="p1"><span class="Apple-converted-space">      </span>const newRow = [0,1,2,3,4,5,6].map(i =&gt; row[i] || '');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Update local cache with server-updated row (including any server timestamps)</p>
<p class="p1"><span class="Apple-converted-space">      </span>selectedRawNotes = newRow[6] || '';</p>
<p class="p1"><span class="Apple-converted-space">      </span>const rec = allRecords.find(r =&gt; r.sheetRow === selectedRowIndex);</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (rec) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>rec.row = newRow;</p>
<p class="p1"><span class="Apple-converted-space">        </span>rec.lastEditMs = Date.now(); // treat this edit as latest change</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Update the currently selected table row in place</p>
<p class="p1"><span class="Apple-converted-space">      </span>const selectedTr = document.querySelector('#dataTable tr.selected');</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (selectedTr) selectedTr.innerHTML = tdHTML(newRow);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Resort by last change and re-render the visible chunk</p>
<p class="p1"><span class="Apple-converted-space">      </span>allRecords.sort((a, b) =&gt; (b.lastEditMs - a.lastEditMs) || (b.sheetRow - a.sheetRow));</p>
<p class="p1"><span class="Apple-converted-space">      </span>renderTable(allRecords.slice(0, ROW_LIMIT));</p>
<p class="p1"><span class="Apple-converted-space">    </span>})</p>
<p class="p1"><span class="Apple-converted-space">    </span>.catch(err =&gt; alert('Edit failed: ' + err))</p>
<p class="p1"><span class="Apple-converted-space">    </span>.finally(() =&gt; setBusy('.edit-btn', false));</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>function addNewNote() {</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (selectedRowIndex === null) { alert('Select a row first.'); return; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>const note = domCache.notes ? domCache.notes.value.trim() : '';</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!note) { alert('Type a note in the Notes box first.'); return; }</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Get existing notes (remove old #number: prefixes)</p>
<p class="p1"><span class="Apple-converted-space">        </span>const existing = (selectedRawNotes || '').replace(/#\d+:\s*/g, '').trim();</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Create timestamp in original format</p>
<p class="p1"><span class="Apple-converted-space">        </span>const ts = new Date().toLocaleString('en-US', {</p>
<p class="p1"><span class="Apple-converted-space">          </span>timeZone: 'America/Chicago',</p>
<p class="p1"><span class="Apple-converted-space">          </span>month: 'short', day: 'numeric', year: 'numeric',</p>
<p class="p1"><span class="Apple-converted-space">          </span>hour: '2-digit', minute: '2-digit'</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Format: [timestamp]: new note (original format)</p>
<p class="p1"><span class="Apple-converted-space">        </span>const newNoteEntry = `${ts}: ${note}`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>const combined = existing ? `${newNoteEntry}\n${existing}` : newNoteEntry;</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Update the notes field and call editRow</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (domCache.notes) domCache.notes.value = '';</p>
<p class="p1"><span class="Apple-converted-space">        </span>selectedRawNotes = combined;</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Use the existing editRow logic but with our formatted notes</p>
<p class="p1"><span class="Apple-converted-space">        </span>setBusy('.add-note-btn', true);</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>const params = new URLSearchParams({</p>
<p class="p1"><span class="Apple-converted-space">          </span>action: 'edit',</p>
<p class="p1"><span class="Apple-converted-space">          </span>password: sessionPassword,</p>
<p class="p1"><span class="Apple-converted-space">          </span>row: selectedRowIndex,</p>
<p class="p1"><span class="Apple-converted-space">          </span>username: domCache.username ? domCache.username.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">          </span>passwordField: domCache.password ? domCache.password.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">          </span>email: domCache.email ? domCache.email.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">          </span>phone: normalizePhone(domCache.phone ? domCache.phone.value.trim() : ''),</p>
<p class="p1"><span class="Apple-converted-space">          </span>server: domCache.server ? domCache.server.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">          </span>autoPay: domCache.autoPay ? domCache.autoPay.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">          </span>notes: combined</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>fetch(scriptURL, { method: 'POST', body: params })</p>
<p class="p1"><span class="Apple-converted-space">          </span>.then(r =&gt; r.text())</p>
<p class="p1"><span class="Apple-converted-space">          </span>.then(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>// Update local cache and resort</p>
<p class="p1"><span class="Apple-converted-space">            </span>const rec = allRecords.find(r =&gt; r.sheetRow === selectedRowIndex);</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (rec) {</p>
<p class="p1"><span class="Apple-converted-space">              </span>rec.row[6] = combined;</p>
<p class="p1"><span class="Apple-converted-space">              </span>rec.lastEditMs = Date.now();</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Update the selected row in the table</p>
<p class="p1"><span class="Apple-converted-space">            </span>const selectedTr = document.querySelector('#dataTable tr.selected');</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (selectedTr) selectedTr.innerHTML = tdHTML(rec.row);</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Resort and re-render</p>
<p class="p1"><span class="Apple-converted-space">            </span>sortRecords(allRecords);</p>
<p class="p1"><span class="Apple-converted-space">            </span>renderTable(allRecords.slice(0, ROW_LIMIT));</p>
<p class="p1"><span class="Apple-converted-space">          </span>})</p>
<p class="p1"><span class="Apple-converted-space">          </span>.catch(err =&gt; alert('Failed to add note: ' + err))</p>
<p class="p1"><span class="Apple-converted-space">          </span>.finally(() =&gt; setBusy('.add-note-btn', false));</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>window.addNewNote = addNewNote;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">          </span>function addRow() {</p>
<p class="p1"><span class="Apple-converted-space">        </span>setBusy('.add-btn', true);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Use cached DOM elements for better performance</p>
<p class="p1"><span class="Apple-converted-space">        </span>const username = domCache.username ? domCache.username.value.trim() : '';</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!username) { alert('Username is required.'); setBusy('.add-btn', false); return; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (existingUsernames.includes(username.toLowerCase())) { alert('Username already exists'); setBusy('.add-btn', false); return; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>const data = {</p>
<p class="p1"><span class="Apple-converted-space">          </span>action: 'add',</p>
<p class="p1"><span class="Apple-converted-space">          </span>password: sessionPassword,</p>
<p class="p1"><span class="Apple-converted-space">          </span>username: username,</p>
<p class="p1"><span class="Apple-converted-space">          </span>passwordField: domCache.password ? domCache.password.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">          </span>email: domCache.email ? domCache.email.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">          </span>phone: normalizePhone(domCache.phone ? domCache.phone.value.trim() : ''),</p>
<p class="p1"><span class="Apple-converted-space">          </span>server: domCache.server ? domCache.server.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">          </span>autoPay: domCache.autoPay ? domCache.autoPay.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">          </span>notes: domCache.notes ? domCache.notes.value.trim() : ''</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// 1) Save to Apps Script</p>
<p class="p1"><span class="Apple-converted-space">        </span>fetch(scriptURL, { method: 'POST', body: new URLSearchParams(data) })</p>
<p class="p1"><span class="Apple-converted-space">          </span>.then(r =&gt; r.text())</p>
<p class="p1"><span class="Apple-converted-space">          </span>.then(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>// 2) Refresh JUST the newly added row from Google Sheets</p>
<p class="p1"><span class="Apple-converted-space">            </span>//<span class="Apple-converted-space">    </span>First get the Username column to find the new row index.</p>
<p class="p1"><span class="Apple-converted-space">            </span>const usernamesRange = 'data!A2:A3000';</p>
<p class="p1"><span class="Apple-converted-space">            </span>const urlA = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${encodeURIComponent(usernamesRange)}?key=${apiKey}`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>return fetch(urlA).then(res =&gt; res.json()).then(col =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">              </span>const arr = (col &amp;&amp; col.values) ? col.values.map(v =&gt; (v[0] || '')) : [];</p>
<p class="p1"><span class="Apple-converted-space">              </span>const target = username.toLowerCase();</p>
<p class="p1"><span class="Apple-converted-space">              </span>let foundIndex = -1;</p>
<p class="p1"><span class="Apple-converted-space">              </span>for (let i = arr.length - 1; i &gt;= 0; i--) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if ((arr[i] || '').toLowerCase() === target) { foundIndex = i; break; }</p>
<p class="p1"><span class="Apple-converted-space">              </span>}</p>
<p class="p1"><span class="Apple-converted-space">              </span>if (foundIndex === -1) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>// Fallback: full reload if we can't find it for any reason.</p>
<p class="p1"><span class="Apple-converted-space">                </span>loadData();</p>
<p class="p1"><span class="Apple-converted-space">                </span>clearForm();</p>
<p class="p1"><span class="Apple-converted-space">                </span>return null;</p>
<p class="p1"><span class="Apple-converted-space">              </span>}</p>
<p class="p1"><span class="Apple-converted-space">              </span>const sheetRow = 2 + foundIndex; // because A2 is index 0</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">              </span>const singleRange = `data!A${sheetRow}:G${sheetRow}`;</p>
<p class="p1"><span class="Apple-converted-space">              </span>const urlRow = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${encodeURIComponent(singleRange)}?key=${apiKey}`;</p>
<p class="p1"><span class="Apple-converted-space">              </span>return fetch(urlRow).then(r2 =&gt; r2.json()).then(data2 =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const row = (data2 &amp;&amp; data2.values &amp;&amp; data2.values[0]) ? data2.values[0] : [];</p>
<p class="p1"><span class="Apple-converted-space">                </span>const newRow = [0,1,2,3,4,5,6].map(i =&gt; row[i] || '');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 3) Update local caches and sort by latest change (this row)</p>
<p class="p1"><span class="Apple-converted-space">                </span>existingUsernames.push(username.toLowerCase());</p>
<p class="p1"><span class="Apple-converted-space">                </span>totalRows = Math.max(totalRows, sheetRow);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const rec = {</p>
<p class="p1"><span class="Apple-converted-space">                  </span>row: newRow,</p>
<p class="p1"><span class="Apple-converted-space">                  </span>sheetRow: sheetRow,</p>
<p class="p1"><span class="Apple-converted-space">                  </span>lastEditMs: Date.now() // treat this add as the latest change</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p1"><span class="Apple-converted-space">                </span>allRecords.push(rec);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>sortRecords(allRecords);</p>
<p class="p1"><span class="Apple-converted-space">                </span>renderTable(allRecords.slice(0, ROW_LIMIT));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>clearForm();</p>
<p class="p1"><span class="Apple-converted-space">                </span>return null;</p>
<p class="p1"><span class="Apple-converted-space">              </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">          </span>})</p>
<p class="p1"><span class="Apple-converted-space">          </span>.catch(err =&gt; { console.error(err); alert('Error saving row.'); })</p>
<p class="p1"><span class="Apple-converted-space">          </span>.finally(() =&gt; setBusy('.add-btn', false));</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>window.addRow = addRow;</p>
<p class="p1"><span class="Apple-converted-space">      </span>function addCriticalAlert() {</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (selectedRowIndex === null) { alert('Select a row first.'); return; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const msg = prompt('Enter the CRITICAL ALERT message for this row:');</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (msg === null) return; <span class="Apple-converted-space">                </span>// user canceled</p>
<p class="p1"><span class="Apple-converted-space">  </span>const trimmed = msg.trim();</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (!trimmed) { alert('Alert message cannot be empty.'); return; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Keep everything else in Notes, but ensure only one [CRITICAL_ALERT] line exists (always on top)</p>
<p class="p1"><span class="Apple-converted-space">  </span>const existing = (selectedRawNotes || '').replace(/#\d+:\s*/g, '').trim();</p>
<p class="p1"><span class="Apple-converted-space">  </span>const cleaned = existing</p>
<p class="p1"><span class="Apple-converted-space">    </span>.split('\n')</p>
<p class="p1"><span class="Apple-converted-space">    </span>.filter(line =&gt; !line.startsWith('[CRITICAL_ALERT]'))</p>
<p class="p1"><span class="Apple-converted-space">    </span>.join('\n');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const combined = `[CRITICAL_ALERT] ${trimmed}` + (cleaned ? `\n${cleaned}` : '');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const params = new URLSearchParams({</p>
<p class="p1"><span class="Apple-converted-space">    </span>action: 'edit',</p>
<p class="p1"><span class="Apple-converted-space">    </span>password: sessionPassword,</p>
<p class="p1"><span class="Apple-converted-space">    </span>row: selectedRowIndex,</p>
<p class="p1"><span class="Apple-converted-space">    </span>username: domCache.username ? domCache.username.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">    </span>passwordField: domCache.password ? domCache.password.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">    </span>email: domCache.email ? domCache.email.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">    </span>phone: normalizePhone(domCache.phone ? domCache.phone.value.trim() : ''),</p>
<p class="p1"><span class="Apple-converted-space">    </span>server: domCache.server ? domCache.server.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">    </span>autoPay: domCache.autoPay ? domCache.autoPay.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">    </span>notes: combined</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// <span class="s1">✅</span> No page refresh: update UI + local cache, then resort by last change</p>
<p class="p1"><span class="Apple-converted-space">  </span>fetch(scriptURL, { method: 'POST', body: params })</p>
<p class="p1"><span class="Apple-converted-space">    </span>.then(r =&gt; r.text())</p>
<p class="p1"><span class="Apple-converted-space">    </span>.then(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>alert('Critical alert saved.');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Update our in-memory state + row UI</p>
<p class="p1"><span class="Apple-converted-space">      </span>selectedRawNotes = combined;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>const rec = allRecords.find(r =&gt; r.sheetRow === selectedRowIndex);</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (rec) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const newRow = [</p>
<p class="p1"><span class="Apple-converted-space">          </span>domCache.username ? domCache.username.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">          </span>domCache.password ? domCache.password.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">          </span>domCache.email ? domCache.email.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">          </span>normalizePhone(domCache.phone ? domCache.phone.value.trim() : ''),</p>
<p class="p1"><span class="Apple-converted-space">          </span>domCache.server ? domCache.server.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">          </span>domCache.autoPay ? domCache.autoPay.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">          </span>combined</p>
<p class="p1"><span class="Apple-converted-space">        </span>];</p>
<p class="p1"><span class="Apple-converted-space">        </span>rec.row = newRow;</p>
<p class="p1"><span class="Apple-converted-space">        </span>rec.lastEditMs = Date.now(); // treat this as latest change</p>
<p class="p1"><span class="Apple-converted-space">        </span>const selectedTr = document.querySelector('#dataTable tr.selected');</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (selectedTr) selectedTr.innerHTML = tdHTML(newRow);</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Resort by last change and re-render the visible chunk (no network)</p>
<p class="p1"><span class="Apple-converted-space">      </span>allRecords.sort((a, b) =&gt; (b.lastEditMs - a.lastEditMs) || (b.sheetRow - a.sheetRow));</p>
<p class="p1"><span class="Apple-converted-space">      </span>renderTable(allRecords.slice(0, ROW_LIMIT));</p>
<p class="p1"><span class="Apple-converted-space">    </span>})</p>
<p class="p1"><span class="Apple-converted-space">    </span>.catch(err =&gt; alert('Failed to save critical alert: ' + err));</p>
<p class="p1">}</p>
<p class="p1">window.addCriticalAlert = addCriticalAlert;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>function removeCriticalAlert() {</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (selectedRowIndex === null) {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">          </span>alert('Select a row first.');<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">          </span>return;<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Check if the selected row has a critical alert</p>
<p class="p1"><span class="Apple-converted-space">        </span>const noteCell = selectedRawNotes || '';</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!noteCell.includes('[CRITICAL_ALERT]')) {</p>
<p class="p1"><span class="Apple-converted-space">          </span>alert('No critical alert found on this row.');</p>
<p class="p1"><span class="Apple-converted-space">          </span>return;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!confirm('Remove the critical alert from this row?')) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Remove all critical alert lines</p>
<p class="p1"><span class="Apple-converted-space">        </span>const cleaned = noteCell</p>
<p class="p1"><span class="Apple-converted-space">          </span>.split('\n')</p>
<p class="p1"><span class="Apple-converted-space">          </span>.filter(line =&gt; !line.startsWith('[CRITICAL_ALERT]'))</p>
<p class="p1"><span class="Apple-converted-space">          </span>.join('\n')</p>
<p class="p1"><span class="Apple-converted-space">          </span>.trim();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>const params = new URLSearchParams({</p>
<p class="p1"><span class="Apple-converted-space">          </span>action: 'edit',</p>
<p class="p1"><span class="Apple-converted-space">          </span>password: sessionPassword,</p>
<p class="p1"><span class="Apple-converted-space">          </span>row: selectedRowIndex,</p>
<p class="p1"><span class="Apple-converted-space">          </span>username: domCache.username ? domCache.username.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">          </span>passwordField: domCache.password ? domCache.password.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">          </span>email: domCache.email ? domCache.email.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">          </span>phone: normalizePhone(domCache.phone ? domCache.phone.value.trim() : ''),</p>
<p class="p1"><span class="Apple-converted-space">          </span>server: domCache.server ? domCache.server.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">          </span>autoPay: domCache.autoPay ? domCache.autoPay.value.trim() : '',</p>
<p class="p1"><span class="Apple-converted-space">          </span>notes: cleaned</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>setBusy('.remove-alert-btn', true);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>fetch(scriptURL, { method: 'POST', body: params })</p>
<p class="p1"><span class="Apple-converted-space">          </span>.then(r =&gt; r.text())</p>
<p class="p1"><span class="Apple-converted-space">          </span>.then(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>alert('Critical alert removed successfully.');</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Update local cache and UI</p>
<p class="p1"><span class="Apple-converted-space">            </span>selectedRawNotes = cleaned;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>const rec = allRecords.find(r =&gt; r.sheetRow === selectedRowIndex);</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (rec) {</p>
<p class="p1"><span class="Apple-converted-space">              </span>rec.row[6] = cleaned;</p>
<p class="p1"><span class="Apple-converted-space">              </span>rec.lastEditMs = Date.now();</p>
<p class="p2"><span class="Apple-converted-space">              </span></p>
<p class="p1"><span class="Apple-converted-space">              </span>// Update the selected row in the table</p>
<p class="p1"><span class="Apple-converted-space">              </span>const selectedTr = document.querySelector('#dataTable tr.selected');</p>
<p class="p1"><span class="Apple-converted-space">              </span>if (selectedTr) selectedTr.innerHTML = tdHTML(rec.row);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Resort and re-render</p>
<p class="p1"><span class="Apple-converted-space">            </span>sortRecords(allRecords);</p>
<p class="p1"><span class="Apple-converted-space">            </span>renderTable(allRecords.slice(0, ROW_LIMIT));</p>
<p class="p1"><span class="Apple-converted-space">          </span>})</p>
<p class="p1"><span class="Apple-converted-space">          </span>.catch(err =&gt; alert('Failed to remove critical alert: ' + err))</p>
<p class="p1"><span class="Apple-converted-space">          </span>.finally(() =&gt; setBusy('.remove-alert-btn', false));</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>window.removeCriticalAlert = removeCriticalAlert;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/script&gt;</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">&lt;/body&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
