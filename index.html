<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2487.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px Courier; color: #ffffff; -webkit-text-stroke: #ffffff}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px Courier; color: #ffffff; -webkit-text-stroke: #ffffff; min-height: 16.0px}
    span.s1 {font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE html&gt;</span></p>
<p class="p1"><span class="s1">&lt;html lang="en"&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">&lt;head&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;meta charset="UTF-8"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;title&gt;Google Sheets Manager&lt;/title&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;!-- Preload login background --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;link rel="preload" as="image" href="bg.jpg"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;!-- Preload app background --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;link rel="preload" as="image"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>href="https://raw.githubusercontent.com/Domichico20/sheets-web-app/main/pexels-codioful-6985045.jpg"&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;link rel="preload" as="image" href="logo.png"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;link rel="preload" as="image" href="https://raw.githubusercontent.com/Domichico20/sheets-web-app/main/logo.png"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;link rel="icon" type="image/png"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>href="https://raw.githubusercontent.com/Domichico20/sheets-web-app/main/1%20logo.png?v=12"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;link rel="shortcut icon" type="image/png"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>href="https://raw.githubusercontent.com/Domichico20/sheets-web-app/main/1%20logo.png?v=12"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;link rel="apple-touch-icon" href="https://raw.githubusercontent.com/Domichico20/sheets-web-app/main/logo.png?v=6"&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;link rel="preconnect" href="https://fonts.googleapis.com"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;link rel="preconnect" href="https://fonts.gstatic.com" crossorigin&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;!-- speed: warm up API connections --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;link rel="preconnect" href="https://sheets.googleapis.com" crossorigin&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;link rel="dns-prefetch" href="https://sheets.googleapis.com"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;link rel="preconnect" href="https://script.google.com" crossorigin&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;link rel="dns-prefetch" href="https://script.google.com"&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&amp;display=swap" rel="stylesheet"&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;style&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>* {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>margin: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>padding: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>box-sizing: border-box;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>font-family: 'Poppins', Arial, sans-serif;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>body {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>margin: 20px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background-color: #f0f0f0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>header {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>text-align: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>margin-bottom: 20px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>position: relative;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>z-index: 2;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>header img.logo {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>max-width: 200px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>height: auto;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>h2 {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>font-size: 1.75rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>font-weight: 600;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>text-align: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>margin-bottom: 20px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background: linear-gradient(90deg,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>#003366, #0066CC, #3399FF, #ff3333, #ffa733, #9a9c21, #54cc25, #1a8371, #229ea7, #33b4ff, #339cff);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background-size: 200% auto;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background-clip: text;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>-webkit-background-clip: text;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>-webkit-text-fill-color: transparent;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>animation: gradientShift 10s linear infinite;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>@media (prefers-reduced-motion: reduce) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>h2 {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>animation: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>@keyframes gradientShift {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>0% { background-position: 0% center; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>100% { background-position: 200% center; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* --- Login section as a centered card --- */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>#loginSection {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>display: flex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>justify-content: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>align-items: flex-start;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>/* ⬅️ no vertical centering */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>padding: 8px 16px 40px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>/* small top padding only */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>min-height: auto;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>/* ⬅️ remove forced height */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.login-card { margin-top: 4px; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.login-card {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>position: relative;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>width: min(420px, 92vw);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>padding: 28px 24px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background: rgba(255, 255, 255, 0.92);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border-radius: 16px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border: 1px solid rgba(0, 0, 0, 0.06);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>box-shadow: 0 20px 60px rgba(0, 0, 0, .15);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>backdrop-filter: blur(6px);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.login-card::before {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>content: "";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>position: absolute;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>inset: -2px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border-radius: inherit;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background: linear-gradient(45deg,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>#FF0000, #FF7300, #FFFB00, #48FF00,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>#00FFD5, #002BFF, #FF00C8, #FF0000);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background-size: 600%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>filter: blur(14px);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>z-index: -1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>opacity: .30;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>animation: glowRainbow 20s linear infinite;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.login-card .brand {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>display: flex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>align-items: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>gap: 10px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>font-weight: 700;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>font-size: 1.25rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>margin-bottom: 14px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>color: #003366;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.inputbox { position: relative; margin: 12px 0 6px; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.inputbox input {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>width: 100%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>padding: 14px 12px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>font-size: 1rem; /* &gt;=16px on most browsers =&gt; no iOS zoom */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border: 1px solid #d6d6d6;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border-radius: 12px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>outline: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background: #fff;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.inputbox label {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>position: absolute;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>left: 12px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>top: 50%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>transform: translateY(-50%);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background: #fff;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>padding: 0 6px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>color: #666;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>pointer-events: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>transition: .18s ease;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.inputbox input:focus+label,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.inputbox input:not(:placeholder-shown)+label {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>top: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>font-size: .8rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>color: #003366;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* ========= Shared glow animation ========= */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>@keyframes glowRainbow {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>0% { background-position: 0 0; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>50% { background-position: 400% 0; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>100% { background-position: 0 0; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* Unlock button base */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>#loginSection .unlock-btn {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>margin-left: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>padding: 15px 40px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>outline: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>cursor: pointer;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>position: relative;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border-radius: 12px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background-color: #2952db;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>color: #FFF;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>font-size: 1.1rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>isolation: isolate;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>width: 100%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>margin-top: 14px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* ====== Rest of your styles (unchanged) ====== */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>#searchSection {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>display: flex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>justify-content: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>align-items: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>margin-bottom: 20px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>#searchSection input[type="text"] {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>flex: 0 0 50%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>max-width: 600px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>padding: 10px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>font-size: 1rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border: 1px solid #d6d6d6;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border-radius: 12px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>#searchSection button.search-btn {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>padding: 20px 40px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>font-size: 1.25rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>margin-left: 20px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background-color: #92e67d;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border-radius: 12px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.add-note-btn { background-color: #6934be; color: #fff; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.critical-btn { background-color: #fc933d; color: #fff; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.remove-alert-btn { background-color: #d93025; color: #fff; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.form-section {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>display: flex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>flex-wrap: wrap;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>gap: 20px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>margin-bottom: 20px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>justify-content: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.form-group { display: flex; flex-direction: column; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.form-group label { font-weight: bold; margin-bottom: 5px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.form-group input {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>padding: 10px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>font-size: 1rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>width: 175px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border: 1px solid #d6d6d6;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border-radius: 12px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.button-row {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>display: flex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>align-items: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>justify-content: center; /* center the whole bar */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>margin: 20px 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.button-group.center {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>display: flex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>align-items: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>gap: 10px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>flex-wrap: nowrap; /* keep on one line */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* If the screen is small, allow wrapping (optional) */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>@media (max-width: 700px) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>.button-group.center {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>flex-wrap: wrap;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>justify-content: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.button-group { display: flex; gap: 10px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.button-group button {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>padding: 20px 40px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>font-size: 1.25rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>color: white;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border-radius: 12px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>cursor: pointer;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.add-btn<span class="Apple-converted-space">    </span>{ background-color: #003366; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.edit-btn <span class="Apple-converted-space">  </span>{ background-color: #3399FF; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.clear-btn<span class="Apple-converted-space">  </span>{ background-color: #66CC66; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.refresh-btn{ background-color: gold; color: black; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.delete-btn { background-color: red; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>table {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>margin: 0 auto;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>width: auto;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border-collapse: separate;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border-spacing: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background: white;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border-radius: 12px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>overflow: hidden;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>table th:nth-child(3),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>table td:nth-child(3) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>max-width: 250px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>overflow: hidden;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>text-overflow: ellipsis;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>white-space: nowrap;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>table th,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>table td {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border: 1px solid #ccc;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>padding: 8px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>text-align: left;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>white-space: nowrap;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>table th { background-color: #4285F4; color: white; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>tr.selected { background-color: rgb(238, 217, 217); }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* ========= SAME gradient glow for ALL buttons ========= */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.button-group button,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>#searchSection .search-btn,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>#loginSection .unlock-btn {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>position: relative;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>isolation: isolate;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>z-index: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.button-group button::before,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>#searchSection .search-btn::before,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>#loginSection .unlock-btn::before {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>content: "";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>position: absolute;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>inset: -2px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border-radius: inherit;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background: linear-gradient(45deg,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>#FF0000, #FF7300, #FFFB00, #48FF00,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>#00FFD5, #002BFF, #FF00C8, #FF0000);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background-size: 600%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>filter: blur(8px);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>animation: glowRainbow 20s linear infinite;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>transition: opacity .3s ease-in-out;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>opacity: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>z-index: -1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.button-group button:hover::before,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>#searchSection .search-btn:hover::before,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>#loginSection .unlock-btn:hover::before {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>opacity: 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* --- Notes wrapping + scroll + WhatsApp link styling --- */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>table th:nth-child(7),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>table td:nth-child(7) { width: 550px; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.notes-cell {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>max-height: 180px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>overflow: auto;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>white-space: normal;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>line-height: 1.35;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.note-entry { margin: 0 0 .55em 0; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.note-entry .ts { font-weight: 100; color: #880000; font-size: 1.05rem; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* 🔴 Critical alert highlight */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.note-entry.critical {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background: #d93025; /* Google red */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>color: #fff;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>font-weight: 700;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border-radius: 10px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>padding: 6px 10px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>display: inline-block;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.phone-wa a { text-decoration: none; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* Make the Notes input wider */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>#notes { width: 500px; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* Optional: keep it fluid on small screens */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>@media (max-width: 600px) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>#notes { width: 100%; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* ===== Login-only background (uses bg.jpg) ===== */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>body.login-bg {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>min-height: 100vh;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background: url('bg.jpg') center / cover no-repeat;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* subtle dark overlay to boost contrast behind the card */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>body.login-bg::before {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>content: "";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>position: fixed;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>inset: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background: rgba(0, 0, 0, .35);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>pointer-events: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>z-index: -1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* ===== App (2nd page) background ===== */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>body.app-bg {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>min-height: 100vh;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background: url('https://raw.githubusercontent.com/Domichico20/sheets-web-app/main/pexels-codioful-6985045.jpg') center / cover no-repeat;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* Hide the app by default; only show it after login when body.app-bg is set */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>#appSection { display: none; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>body.app-bg #appSection { display: block; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* =========================================================</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">       </span>✅ MOBILE + PERFORMANCE ADDITIONS (ONLY NEW STUFF BELOW)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">       </span>========================================================= */</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* Touch targets &amp; smoother taps */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.button-group button,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>#searchSection .search-btn,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>#loginSection .unlock-btn {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>min-height: 44px; <span class="Apple-converted-space">            </span>/* thumb-friendly */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>will-change: transform; <span class="Apple-converted-space">      </span>/* (the line that was cut off) */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>-webkit-tap-highlight-color: transparent;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* Make the table paint faster and scroll nicely on mobile */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>#dataTable {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>content-visibility: auto; <span class="Apple-converted-space">                </span>/* paint only when visible */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>contain-intrinsic-size: 600px 400px;<span class="Apple-converted-space">      </span>/* reserve size for faster paint */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>@media (max-width: 900px) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>body { margin: 10px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>header img.logo { max-width: 150px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>@media (max-width: 768px) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>/* Stack the search bar */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>#searchSection {<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>flex-direction: column;<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>align-items: stretch;<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>gap: 10px;<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>#searchSection input[type="text"] {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>flex: 1 1 auto;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>max-width: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>width: 100%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>#searchSection button.search-btn {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>margin-left: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>width: 100%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>padding: 14px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>font-size: 1.05rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>/* Inputs full-width in small screens */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>.form-group input { width: 100%; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>/* Button group wraps nicely */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>.button-group.center { flex-wrap: wrap; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>.button-group.center button {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>flex: 1 1 48%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>padding: 14px 16px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>font-size: 1rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>/* Table horizontal scroll instead of squeezing columns */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>table { width: 100%; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>#dataTable {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>display: block;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>overflow-x: auto;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>-webkit-overflow-scrolling: touch;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>#dataTable thead,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>#dataTable tbody,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>#dataTable tr,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>#dataTable th,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>#dataTable td {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>white-space: nowrap;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>table th:nth-child(7),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>table td:nth-child(7) { width: auto; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>.notes-cell { max-height: 120px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>@media (max-width: 480px) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>.login-card { width: 100%; padding: 20px 16px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>.button-group.center button { flex-basis: 100%; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>h2 { font-size: 1.25rem; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* Disable heavy glow/animation on phones &amp; reduced motion for snappier taps */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>@media (prefers-reduced-motion: reduce), (max-width: 768px) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>h2 { animation: none !important; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>.button-group button::before,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>#searchSection .search-btn::before,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>#loginSection .unlock-btn::before,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>.login-card::before {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>display: none !important; <span class="Apple-converted-space">  </span>/* remove blurred gradient layer */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>animation: none !important;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;/style&gt;</span></p>
<p class="p1"><span class="s1">&lt;/head&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">&lt;body&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;header&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;img src="https://raw.githubusercontent.com/Domichico20/sheets-web-app/main/logo.png" alt="Company Logo"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>class="logo" width="200" height="200" decoding="async" fetchpriority="high" referrerpolicy="no-referrer"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>onerror="this.onerror=null; this.src='https://raw.githubusercontent.com/Domichico20/sheets-web-app/main/1%20logo.png';"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;/header&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;div id="loginSection"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div class="login-card"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;h1 class="brand"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;svg aria-hidden="true" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>style="margin-right:4px;color:#2952db"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;path</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>d="M6 10V8a6 6 0 1112 0v2h1a1 1 0 011 1v10a1 1 0 01-1 1H5a1 1 0 01-1-1V11a1 1 0 011-1h1zm2 0h8V8a4 4 0 10-8 0v2z" /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>Osvaldo Nuñez</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/h1&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div class="inputbox"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;input type="password" id="appPassword" placeholder=" "</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>onkeydown="if(event.key==='Enter'){event.preventDefault();checkPassword();}"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;label for="appPassword"&gt;Enter Password&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;button class="unlock-btn" onclick="checkPassword()"&gt;Unlock&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;!-- App UI: hidden by CSS until body gets class 'app-bg' after login --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;div id="appSection"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;form id="searchForm" onsubmit="event.preventDefault(); searchData();"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div id="searchSection"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;input type="text" id="searchQuery" placeholder="Search by username, phone, or email"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button type="submit" class="search-btn"&gt;Search&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/form&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div class="form-section"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div class="form-group"&gt;&lt;label for="username"&gt;Username:&lt;/label&gt;&lt;input type="text" id="username"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div class="form-group"&gt;&lt;label for="password"&gt;Password:&lt;/label&gt;&lt;input type="text" id="password"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div class="form-group"&gt;&lt;label for="email"&gt;Email:&lt;/label&gt;&lt;input type="text" id="email"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div class="form-group"&gt;&lt;label for="phone"&gt;Phone #:&lt;/label&gt;&lt;input type="text" id="phone"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div class="form-group"&gt;&lt;label for="server"&gt;Server:&lt;/label&gt;&lt;input type="text" id="server"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div class="form-group"&gt;&lt;label for="autoPay"&gt;AutoPay:&lt;/label&gt;&lt;input type="text" id="autoPay"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div class="form-group"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;label for="notes"&gt;Notes:&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;input type="text" id="notes"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;input type="hidden" id="rowIndex" /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div class="button-row"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;div class="button-group center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button class="add-btn" onclick="addRow()"&gt;Add&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button class="edit-btn" onclick="confirmEdit()"&gt;Edit&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button class="clear-btn" onclick="clearForm()"&gt;Clear&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button class="refresh-btn" onclick="loadData(true)"&gt;Refresh&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button class="delete-btn" onclick="confirmDelete()"&gt;Delete&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button type="button" class="add-note-btn" onclick="addNewNote()"&gt;Add New Note&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button type="button" class="critical-btn" onclick="addCriticalAlert()"&gt;Add Critical Alert&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;button type="button" class="remove-alert-btn" onclick="removeCriticalAlert()"&gt;Remove Alert&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;table id="dataTable"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;thead&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;tr&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;th&gt;Username&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;th&gt;Password&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;th&gt;Email&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;th&gt;Phone&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;th&gt;Server&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;th&gt;AutoPay&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>&lt;th&gt;Notes&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/tr&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;/thead&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>&lt;tbody&gt;&lt;/tbody&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/table&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* ---------- Login background on first load ---------- */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>document.addEventListener('DOMContentLoaded', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>document.body.classList.add('login-bg');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>initDOMCache(); // Initialize DOM cache for performance</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* ---------- App constants ---------- */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const ROW_LIMIT = 25;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const scriptURL = 'https://script.google.com/macros/s/AKfycbzB8lRPMU0nZRSoU6CoRL_fcYstdq9pWPeZKdwuSp6O0QSsa95Oh49UnfV6uB9wt9w/exec';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const sheetId = '1IR2TT4isrhET-3krSHV1BC8mE6xAhy0MEnR0h5-xBzs';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const apiKey = 'AIzaSyC5rmJA1nl0LRhbGe-TsZwOSBfP97SzsHk';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const range = 'data!A1:G3000';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let sessionPassword = "";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let selectedRowIndex = null; <span class="Apple-converted-space">  </span>// 1-based sheet row</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let selectedRawNotes = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let existingUsernames = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let allRecords = []; <span class="Apple-converted-space">          </span>// { row:[...], sheetRow:Number, lastEditMs:Number }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let totalRows = 0;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Performance optimization: Cache DOM elements</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const domCache = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>searchQuery: null,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>username: null,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>password: null,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>email: null,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>phone: null,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>server: null,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>autoPay: null,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>notes: null,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>dataTable: null,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>tbody: null</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>};</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Initialize DOM cache</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function initDOMCache() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>domCache.searchQuery = document.getElementById('searchQuery');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>domCache.username = document.getElementById('username');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>domCache.password = document.getElementById('password');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>domCache.email = document.getElementById('email');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>domCache.phone = document.getElementById('phone');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>domCache.server = document.getElementById('server');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>domCache.autoPay = document.getElementById('autoPay');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>domCache.notes = document.getElementById('notes');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>domCache.dataTable = document.getElementById('dataTable');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>domCache.tbody = document.querySelector('#dataTable tbody');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Debounce search to prevent excessive calls</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let searchTimeout = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function debounceSearch(func, delay = 300) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>return function(...args) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>clearTimeout(searchTimeout);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>searchTimeout = setTimeout(() =&gt; func.apply(this, args), delay);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Request cache to prevent duplicate API calls</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const requestCache = new Map();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const CACHE_DURATION = 5000; // 5 seconds</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function getCachedRequest(url) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const cached = requestCache.get(url);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (cached &amp;&amp; Date.now() - cached.timestamp &lt; CACHE_DURATION) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return cached.data;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>return null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function setCachedRequest(url, data) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>requestCache.set(url, {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>data: data,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>timestamp: Date.now()</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// speed helper: disable/enable a button by selector (prevents double submits)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function setBusy(selector, on) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const btn = document.querySelector(selector);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (btn) btn.disabled = !!on;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* ---------- Login ---------- */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function checkPassword() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const pass = document.getElementById('appPassword').value.trim();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (pass === 'Google#2020') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>sessionPassword = pass;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.body.classList.remove('login-bg');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.body.classList.add('app-bg');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('loginSection').style.display = 'none';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>loadData();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>alert('Incorrect password');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>window.checkPassword = checkPassword; // keep inline onclick working</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* ---------- Helpers (formatting + search) ---------- */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const TS_REGEX = /^(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{1,2},\s\d{4},?\s\d{2}:\d{2}\s(?:AM|PM)/;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function parseLastEditMs(notesCell) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (!notesCell) return 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const firstLine = String(notesCell).split('\n')[0].trim();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const m = firstLine.match(TS_REGEX);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (!m) return 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const ms = Date.parse(m[0]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>return isNaN(ms) ? 0 : ms;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function escapeHTML(s) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>return String(s ?? '').replace(/[&amp;&lt;&gt;"']/g, c =&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>({ '&amp;': '&amp;amp;', '&lt;': '&amp;lt;', '&gt;': '&amp;gt;', '"': '&amp;quot;', "'": '&amp;#39;' }[c]));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function normalizePhone(s) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const d = (s || '').replace(/\D/g, '');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (d.length === 10) return d.replace(/(\d{3})(\d{3})(\d{4})/, '($1) $2-$3');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (d.length === 11 &amp;&amp; d.startsWith('1'))</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return d.replace(/^1(\d{3})(\d{3})(\d{4})/, '1 ($1) $2-$3');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>return s || '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function digitsOnly(s) { return (s || '').replace(/\D/g, ''); }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function phoneLink(s) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const d = digitsOnly(s);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (!d) return '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const wa = (d.length === 10) ? ('1' + d) : (d.length === 11 &amp;&amp; d.startsWith('1') ? d : d);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const display = normalizePhone(s);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>return `&lt;a href="https://wa.me/${wa}" target="_blank" rel="noopener" title="Message on WhatsApp"&gt;${escapeHTML(display)} 📲&lt;/a&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function canonicalEmail(s) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>return (s || '')</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.toLowerCase()</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.replace(/^mailto:\s*/, '')</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.replace(/^mail\s*to:\s*/, '')</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.replace(/\s+/g, '')</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.trim();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function formatNotes(cell) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const stripped = (cell || '').replace(/#\d+:\s*/g, '').trim();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (!stripped) return '';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>// Render line by line so we can style CRITICAL alerts too</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const lines = stripped.split('\n');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>return lines</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.map(line =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>// 🔴 Critical alert line</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>const c = line.match(/^\[CRITICAL_ALERT\]\s*(.*)$/);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>if (c) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const msg = c[1] || '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return `&lt;div class="note-entry critical"&gt;CRITICAL ALERT: ${escapeHTML(msg)}&lt;/div&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>// Normal timestamped note line</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>const m = line.match(/^((?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{1,2},\s\d{4},?\s\d{2}:\d{2}\s(?:AM|PM)):\s*(.*)$/);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>if (!m) return `&lt;div class="note-entry"&gt;&lt;span class="txt"&gt;${escapeHTML(line)}&lt;/span&gt;&lt;/div&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>return `&lt;div class="note-entry"&gt;&lt;span class="ts"&gt;${escapeHTML(m[1])}&lt;/span&gt;: &lt;span class="txt"&gt;${escapeHTML(m[2])}&lt;/span&gt;&lt;/div&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>})</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.join('');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* helper: show CRITICAL alert notification without auto-delete */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function showCriticalAlert(rec) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const noteCell = (rec &amp;&amp; rec.row &amp;&amp; rec.row[6]) ? rec.row[6] : '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const m = (noteCell || '').match(/\[CRITICAL_ALERT\]\s*(.+)/);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (!m) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const message = m[1].trim();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>// Just show the alert without prompting for deletion</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>setTimeout(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>alert(`⚠️ CRITICAL ALERT\n\n${message}\n\nThis alert will remain until manually removed.`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}, 100);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* ---------- Table cell renderer (restores your look) ---------- */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function tdHTML(row) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>return row.map((cell, ci) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (ci === 6) return '&lt;td&gt;&lt;div class="notes-cell"&gt;' + formatNotes(cell) + '&lt;/div&gt;&lt;/td&gt;'; // Notes</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (ci === 3) return '&lt;td class="phone-wa"&gt;' + phoneLink(cell) + '&lt;/td&gt;'; <span class="Apple-converted-space">                </span>// Phone</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return '&lt;td&gt;' + escapeHTML(cell) + '&lt;/td&gt;';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}).join('');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* helper: show CRITICAL alert notification without auto-delete */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function showCriticalAlert(rec) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const noteCell = (rec &amp;&amp; rec.row &amp;&amp; rec.row[6]) ? rec.row[6] : '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const m = (noteCell || '').match(/\[CRITICAL_ALERT\]\s*(.+)/);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (!m) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const message = m[1].trim();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>// Just show the alert without prompting for deletion</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>setTimeout(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>alert(`⚠️ CRITICAL ALERT\n\n${message}\n\nThis alert will remain until manually removed.`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}, 100);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* ---------- Data load + render ---------- */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function renderTable(records){</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!domCache.tbody) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>domCache.tbody.innerHTML = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const frag = document.createDocumentFragment();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>records.forEach(rec =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const row = rec.row;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const tr = document.createElement('tr');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>tr.innerHTML = tdHTML(row);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>tr.addEventListener('click', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>selectedRowIndex = rec.sheetRow; // exact sheet row for edit/delete</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>document.querySelectorAll('#dataTable tr.selected').forEach(r =&gt; r.classList.remove('selected'));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>tr.classList.add('selected');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>// Use cached DOM elements for better performance</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (domCache.username) domCache.username.value = row[0] || '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (domCache.password) domCache.password.value = row[1] || '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (domCache.email) domCache.email.value = row[2] || '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (domCache.phone) domCache.phone.value = row[3] || '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (domCache.server) domCache.server.value = row[4] || '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (domCache.autoPay) domCache.autoPay.value = row[5] || '';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>selectedRawNotes = row[6] || '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (domCache.notes) domCache.notes.value = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const idxEl = document.getElementById('rowIndex');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (idxEl) idxEl.value = selectedRowIndex;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>// Show critical alert (guarded)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (typeof showCriticalAlert === 'function') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>try { showCriticalAlert(rec); } catch (e) { console.warn('Alert show error:', e); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>frag.appendChild(tr);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>domCache.tbody.appendChild(frag);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">   </span>// Tunables</span></p>
<p class="p1"><span class="s1">const REFRESH_COLS = 'A:G';</span></p>
<p class="p1"><span class="s1">const SHEET_TAB<span class="Apple-converted-space">    </span>= 'data';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Safe busy helper (does nothing if not present)</span></p>
<p class="p1"><span class="s1">function setBusySafe(sel, on) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const el = document.querySelector(sel);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!el) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.disabled = !!on;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.style.opacity = on ? .6 : 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>el.style.pointerEvents = on ? 'none' : 'auto';</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Optimized sort helper with better performance</span></p>
<p class="p1"><span class="s1">function sortByRecent(a, b) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// Use bitwise operations for faster comparison</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const timeDiff = b.lastEditMs - a.lastEditMs;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return timeDiff !== 0 ? timeDiff : (b.sheetRow - a.sheetRow);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Optimized sorting for large datasets</span></p>
<p class="p1"><span class="s1">function sortRecords(records) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// Use native sort with optimized comparison</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return records.sort(sortByRecent);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Build the inner &lt;td&gt; HTML for a row (preserve WhatsApp link + notes formatting)</span></p>
<p class="p1"><span class="s1">function tdHTML(rowArr) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>return rowArr.map((cell, ci) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (ci === 6) return '&lt;td&gt;&lt;div class="notes-cell"&gt;' + formatNotes(cell) + '&lt;/div&gt;&lt;/td&gt;'; // Notes</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (ci === 3) return '&lt;td class="phone-wa"&gt;' + phoneLink(cell) + '&lt;/td&gt;'; <span class="Apple-converted-space">                </span>// Phone -&gt; WhatsApp link</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return '&lt;td&gt;' + escapeHTML(cell) + '&lt;/td&gt;';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}).join('');</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Fetch and update a set of sheet rows via one batchGet</span></p>
<p class="p1"><span class="s1">async function refreshRowsBatch(sheetRowNums) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!sheetRowNums.length) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const ranges = sheetRowNums.map(r =&gt; `${SHEET_TAB}!${REFRESH_COLS.split(':')[0]}${r}:${REFRESH_COLS.split(':')[1]}${r}`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const qs = ranges.map(r =&gt; `ranges=${encodeURIComponent(r)}`).join('&amp;');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values:batchGet?${qs}&amp;fields=valueRanges(range,values)&amp;key=${apiKey}`;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const res = await fetch(url);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!res.ok) throw new Error(`HTTP ${res.status}`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const payload = await res.json();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const list = (payload &amp;&amp; payload.valueRanges) || [];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// Map “A123:G123” -&gt; 123</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const rowNumFromRange = (rng) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const m = String(rng || '').match(/!.*?([A-Z]+)(\d+):/i);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return m ? parseInt(m[2], 10) : null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>list.forEach(vr =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const rnum = rowNumFromRange(vr.range);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (!rnum) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const row = (vr.values &amp;&amp; vr.values[0]) ? vr.values[0] : [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const newRow = [0,1,2,3,4,5,6].map(i =&gt; row[i] || '');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// update selected notes cache if applicable</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (typeof selectedRowIndex === 'number' &amp;&amp; rnum === selectedRowIndex) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>selectedRawNotes = newRow[6] || '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// upsert into allRecords</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let rec = allRecords.find(x =&gt; x.sheetRow === rnum);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (rec) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>rec.row = newRow;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>rec.lastEditMs = Date.now(); // treat as latest change</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>rec = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>row: newRow,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>sheetRow: rnum,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>lastEditMs: parseLastEditMs(newRow[6] || '') || Date.now()</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>allRecords.push(rec);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// update DOM cell contents if this row is currently rendered</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const tr = document.querySelector(`#dataTable tbody tr[data-row="${rnum}"]`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (tr) tr.innerHTML = tdHTML(newRow);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Full reload (reduced payload using fields=values)</span></p>
<p class="p1"><span class="s1">async function fullReload() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${encodeURIComponent(range)}?fields=values&amp;key=${apiKey}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const r = await fetch(url);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!r.ok) throw new Error(`HTTP ${r.status}`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const data = await r.json();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const rows = data.values || [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>totalRows = rows.length;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const dataRows = rows.slice(1); // skip header</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>existingUsernames = dataRows.map(r =&gt; (r[0] || '').toLowerCase());</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>allRecords = dataRows.map((row, idx) =&gt; ({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>row,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>sheetRow: idx + 2, // 1-based + header</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>lastEditMs: parseLastEditMs(row[6] || '')</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}));</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>sortRecords(allRecords);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (domCache.searchQuery) domCache.searchQuery.value = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (domCache.tbody) domCache.tbody.innerHTML = '';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderTable(allRecords.slice(0, ROW_LIMIT));</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// === Optimized loader ===</span></p>
<p class="p1"><span class="s1">// - onlySelected === true -&gt; refresh selected row if any,</span></p>
<p class="p1"><span class="s1">// <span class="Apple-converted-space">  </span>otherwise refresh all VISIBLE rows (no selection required).</span></p>
<p class="p1"><span class="s1">// - onlySelected === false -&gt; full reload (lightweight payload).</span></p>
<p class="p1"><span class="s1">async function loadData(onlySelected = false) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>setBusySafe('#refreshBtn', true);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (onlySelected) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>let targets = [];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>// If a row is selected, prefer that…</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (Number.isInteger(selectedRowIndex)) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>targets = [selectedRowIndex];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// …otherwise grab all rows currently rendered in the table</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>targets = Array.from(document.querySelectorAll('#dataTable tbody tr'))</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>.map(tr =&gt; parseInt(tr.dataset.row, 10))</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>.filter(Boolean);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>// Fallback to top chunk if table is empty (e.g., first load)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (targets.length === 0 &amp;&amp; Array.isArray(allRecords) &amp;&amp; allRecords.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>targets = allRecords.slice(0, ROW_LIMIT).map(r =&gt; r.sheetRow);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (targets.length) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>await refreshRowsBatch(Array.from(new Set(targets)));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// keep table sorted by latest change, then show top chunk (fast)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>sortRecords(allRecords);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>renderTable(allRecords.slice(0, ROW_LIMIT));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>// If we still have nothing, do a full reload.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>await fullReload();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>} catch (err) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>console.error(err);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>alert('Failed to load data from Google Sheets.');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>} finally {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>setBusySafe('#refreshBtn', false);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">window.loadData = loadData;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* ---------- Search (optimized with caching and debouncing) ---------- */</span></p>
<p class="p1"><span class="s1">function searchData() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const raw = domCache.searchQuery.value.trim().toLowerCase();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!raw) {<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>renderTable(allRecords.slice(0, ROW_LIMIT));<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>return;<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// Pre-compile regex patterns for better performance</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const qDigits = (raw.match(/\d/g) || []).join('');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const qEmail = canonicalEmail(raw);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const hasPhoneQuery = qDigits.length &gt;= 7;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const hasEmailQuery = qEmail.includes('@');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// Use for loop instead of filter for better performance on large datasets</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const filtered = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>for (let i = 0; i &lt; allRecords.length; i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const rec = allRecords[i];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const row = rec.row;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const baseMatch = row.join(' ').toLowerCase().includes(raw);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let phoneMatch = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (hasPhoneQuery) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const rp = (row[3] || '').replace(/\D/g, '');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const last10 = s =&gt; s.slice(-10);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (rp) phoneMatch = rp.includes(qDigits) || last10(rp) === last10(qDigits);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let emailMatch = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (hasEmailQuery) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const re = canonicalEmail(row[2] || '');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>emailMatch = re.includes(qEmail);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>if (baseMatch || phoneMatch || emailMatch) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>filtered.push(rec);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>renderTable(filtered.slice(0, ROW_LIMIT));</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// If the search narrows to exactly one row and it has a CRITICAL alert, show it immediately</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// After rendering, if any matching row has a CRITICAL alert, show once.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const alertRec = filtered.find(r =&gt; /\[CRITICAL_ALERT\]/.test((r.row[6] || '')));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (alertRec) { showCriticalAlert(alertRec); }</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">// Create debounced version of search</span></p>
<p class="p1"><span class="s1">const debouncedSearch = debounceSearch(searchData, 300);</span></p>
<p class="p1"><span class="s1">window.searchData = searchData;</span></p>
<p class="p1"><span class="s1">window.debouncedSearch = debouncedSearch;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>/* ---------- Add/Edit/Delete (same behavior as before) ---------- */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>function clearForm() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Use cached DOM elements for better performance</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (domCache.username) domCache.username.value = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (domCache.password) domCache.password.value = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (domCache.email) domCache.email.value = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (domCache.phone) domCache.phone.value = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (domCache.server) domCache.server.value = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (domCache.autoPay) domCache.autoPay.value = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (domCache.notes) domCache.notes.value = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (domCache.searchQuery) domCache.searchQuery.value = '';</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.querySelectorAll('#dataTable tr.selected').forEach(r =&gt; r.classList.remove('selected'));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>selectedRowIndex = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>window.clearForm = clearForm;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>function confirmDelete() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (selectedRowIndex === null) { alert('Select a row first.'); return; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!confirm('Delete selected row?')) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setBusy('.delete-btn', true);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>fetch(scriptURL, {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>method: 'POST',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>body: new URLSearchParams({ action: 'delete', password: sessionPassword, row: selectedRowIndex })</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>})</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>.then(res =&gt; res.text())</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>.then(() =&gt; { selectedRowIndex = null; loadData(); })</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>.catch(err =&gt; alert('Delete failed: ' + err))</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>.finally(() =&gt; setBusy('.delete-btn', false));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>window.confirmDelete = confirmDelete;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>function confirmEdit() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (selectedRowIndex === null) { alert('Select a row first!'); return; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!confirm('Save changes to this row?')) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>editRow();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>window.confirmEdit = confirmEdit;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>function editRow() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>setBusy('.edit-btn', true);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// Use cached DOM elements for better performance</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const rawNew = domCache.notes ? domCache.notes.value.trim() : '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const existing = (selectedRawNotes || '').replace(/#\d+:\s*/g, '').trim();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>let combined = existing;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (rawNew) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const ts = new Date().toLocaleString('en-US', {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>timeZone: 'America/Chicago', // match server timezone used on Adds</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>month: 'short', day: 'numeric', year: 'numeric',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>hour: '2-digit', minute: '2-digit'</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>combined = `${ts}: ${rawNew}` + (existing ? `\n${existing}` : '');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const params = new URLSearchParams({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>action: 'edit',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>password: sessionPassword,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>row: selectedRowIndex,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>username: domCache.username ? domCache.username.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>passwordField: domCache.password ? domCache.password.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>email: domCache.email ? domCache.email.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>phone: normalizePhone(domCache.phone ? domCache.phone.value.trim() : ''),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>server: domCache.server ? domCache.server.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>autoPay: domCache.autoPay ? domCache.autoPay.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>notes: combined</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// ✅ Post the edit, then refresh THIS row from Google Sheets (server truth),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// ✅ mark it as latest change, resort, and re-render.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>fetch(scriptURL, { method: 'POST', body: params })</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.then(r =&gt; r.text())</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.then(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const singleRange = `data!A${selectedRowIndex}:G${selectedRowIndex}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${encodeURIComponent(singleRange)}?key=${apiKey}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>return fetch(url).then(res =&gt; res.json());</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>})</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.then(data =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const row = (data &amp;&amp; data.values &amp;&amp; data.values[0]) ? data.values[0] : [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const newRow = [0,1,2,3,4,5,6].map(i =&gt; row[i] || '');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>// Update local cache with server-updated row (including any server timestamps)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>selectedRawNotes = newRow[6] || '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const rec = allRecords.find(r =&gt; r.sheetRow === selectedRowIndex);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (rec) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>rec.row = newRow;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>rec.lastEditMs = Date.now(); // treat this edit as latest change</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>// Update the currently selected table row in place</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const selectedTr = document.querySelector('#dataTable tr.selected');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (selectedTr) selectedTr.innerHTML = tdHTML(newRow);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>// Resort by last change and re-render the visible chunk</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>allRecords.sort((a, b) =&gt; (b.lastEditMs - a.lastEditMs) || (b.sheetRow - a.sheetRow));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>renderTable(allRecords.slice(0, ROW_LIMIT));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>})</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.catch(err =&gt; alert('Edit failed: ' + err))</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.finally(() =&gt; setBusy('.edit-btn', false));</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>function addNewNote() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (selectedRowIndex === null) { alert('Select a row first.'); return; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const note = domCache.notes ? domCache.notes.value.trim() : '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!note) { alert('Type a note in the Notes box first.'); return; }</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Get existing notes (remove old #number: prefixes)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const existing = (selectedRawNotes || '').replace(/#\d+:\s*/g, '').trim();</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Create timestamp in original format</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const ts = new Date().toLocaleString('en-US', {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>timeZone: 'America/Chicago',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>month: 'short', day: 'numeric', year: 'numeric',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>hour: '2-digit', minute: '2-digit'</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Format: [timestamp]: new note (original format)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const newNoteEntry = `${ts}: ${note}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const combined = existing ? `${newNoteEntry}\n${existing}` : newNoteEntry;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Update the notes field and call editRow</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (domCache.notes) domCache.notes.value = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>selectedRawNotes = combined;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Use the existing editRow logic but with our formatted notes</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setBusy('.add-note-btn', true);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const params = new URLSearchParams({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>action: 'edit',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>password: sessionPassword,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>row: selectedRowIndex,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>username: domCache.username ? domCache.username.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>passwordField: domCache.password ? domCache.password.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>email: domCache.email ? domCache.email.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>phone: normalizePhone(domCache.phone ? domCache.phone.value.trim() : ''),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>server: domCache.server ? domCache.server.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>autoPay: domCache.autoPay ? domCache.autoPay.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>notes: combined</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>fetch(scriptURL, { method: 'POST', body: params })</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>.then(r =&gt; r.text())</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>.then(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Update local cache and resort</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const rec = allRecords.find(r =&gt; r.sheetRow === selectedRowIndex);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (rec) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>rec.row[6] = combined;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>rec.lastEditMs = Date.now();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Update the selected row in the table</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const selectedTr = document.querySelector('#dataTable tr.selected');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (selectedTr) selectedTr.innerHTML = tdHTML(rec.row);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Resort and re-render</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>sortRecords(allRecords);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>renderTable(allRecords.slice(0, ROW_LIMIT));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>})</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>.catch(err =&gt; alert('Failed to add note: ' + err))</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>.finally(() =&gt; setBusy('.add-note-btn', false));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>window.addNewNote = addNewNote;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>function addRow() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setBusy('.add-btn', true);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Use cached DOM elements for better performance</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const username = domCache.username ? domCache.username.value.trim() : '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!username) { alert('Username is required.'); setBusy('.add-btn', false); return; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (existingUsernames.includes(username.toLowerCase())) { alert('Username already exists'); setBusy('.add-btn', false); return; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const data = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>action: 'add',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>password: sessionPassword,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>username: username,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>passwordField: domCache.password ? domCache.password.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>email: domCache.email ? domCache.email.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>phone: normalizePhone(domCache.phone ? domCache.phone.value.trim() : ''),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>server: domCache.server ? domCache.server.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>autoPay: domCache.autoPay ? domCache.autoPay.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>notes: domCache.notes ? domCache.notes.value.trim() : ''</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// 1) Save to Apps Script</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>fetch(scriptURL, { method: 'POST', body: new URLSearchParams(data) })</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>.then(r =&gt; r.text())</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>.then(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// 2) Refresh JUST the newly added row from Google Sheets</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>//<span class="Apple-converted-space">    </span>First get the Username column to find the new row index.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const usernamesRange = 'data!A2:A3000';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const urlA = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${encodeURIComponent(usernamesRange)}?key=${apiKey}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return fetch(urlA).then(res =&gt; res.json()).then(col =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>const arr = (col &amp;&amp; col.values) ? col.values.map(v =&gt; (v[0] || '')) : [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>const target = username.toLowerCase();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>let foundIndex = -1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>for (let i = arr.length - 1; i &gt;= 0; i--) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if ((arr[i] || '').toLowerCase() === target) { foundIndex = i; break; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>if (foundIndex === -1) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>// Fallback: full reload if we can't find it for any reason.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>loadData();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>clearForm();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>const sheetRow = 2 + foundIndex; // because A2 is index 0</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>const singleRange = `data!A${sheetRow}:G${sheetRow}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>const urlRow = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${encodeURIComponent(singleRange)}?key=${apiKey}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>return fetch(urlRow).then(r2 =&gt; r2.json()).then(data2 =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const row = (data2 &amp;&amp; data2.values &amp;&amp; data2.values[0]) ? data2.values[0] : [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const newRow = [0,1,2,3,4,5,6].map(i =&gt; row[i] || '');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>// 3) Update local caches and sort by latest change (this row)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>existingUsernames.push(username.toLowerCase());</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>totalRows = Math.max(totalRows, sheetRow);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const rec = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>row: newRow,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>sheetRow: sheetRow,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                  </span>lastEditMs: Date.now() // treat this add as the latest change</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>allRecords.push(rec);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>sortRecords(allRecords);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>renderTable(allRecords.slice(0, ROW_LIMIT));</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>clearForm();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>})</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>.catch(err =&gt; { console.error(err); alert('Error saving row.'); })</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>.finally(() =&gt; setBusy('.add-btn', false));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>window.addRow = addRow;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>function addCriticalAlert() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (selectedRowIndex === null) { alert('Select a row first.'); return; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const msg = prompt('Enter the CRITICAL ALERT message for this row:');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (msg === null) return; <span class="Apple-converted-space">                </span>// user canceled</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const trimmed = msg.trim();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>if (!trimmed) { alert('Alert message cannot be empty.'); return; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// Keep everything else in Notes, but ensure only one [CRITICAL_ALERT] line exists (always on top)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const existing = (selectedRawNotes || '').replace(/#\d+:\s*/g, '').trim();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const cleaned = existing</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.split('\n')</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.filter(line =&gt; !line.startsWith('[CRITICAL_ALERT]'))</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.join('\n');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const combined = `[CRITICAL_ALERT] ${trimmed}` + (cleaned ? `\n${cleaned}` : '');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>const params = new URLSearchParams({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>action: 'edit',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>password: sessionPassword,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>row: selectedRowIndex,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>username: domCache.username ? domCache.username.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>passwordField: domCache.password ? domCache.password.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>email: domCache.email ? domCache.email.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>phone: normalizePhone(domCache.phone ? domCache.phone.value.trim() : ''),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>server: domCache.server ? domCache.server.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>autoPay: domCache.autoPay ? domCache.autoPay.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>notes: combined</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>// ✅ No page refresh: update UI + local cache, then resort by last change</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>fetch(scriptURL, { method: 'POST', body: params })</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.then(r =&gt; r.text())</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.then(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>alert('Critical alert saved.');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>// Update our in-memory state + row UI</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>selectedRawNotes = combined;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>const rec = allRecords.find(r =&gt; r.sheetRow === selectedRowIndex);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>if (rec) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const newRow = [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>domCache.username ? domCache.username.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>domCache.password ? domCache.password.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>domCache.email ? domCache.email.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>normalizePhone(domCache.phone ? domCache.phone.value.trim() : ''),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>domCache.server ? domCache.server.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>domCache.autoPay ? domCache.autoPay.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>combined</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>rec.row = newRow;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>rec.lastEditMs = Date.now(); // treat this as latest change</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const selectedTr = document.querySelector('#dataTable tr.selected');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (selectedTr) selectedTr.innerHTML = tdHTML(newRow);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>// Resort by last change and re-render the visible chunk (no network)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>allRecords.sort((a, b) =&gt; (b.lastEditMs - a.lastEditMs) || (b.sheetRow - a.sheetRow));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>renderTable(allRecords.slice(0, ROW_LIMIT));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>})</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.catch(err =&gt; alert('Failed to save critical alert: ' + err));</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">window.addCriticalAlert = addCriticalAlert;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>function removeCriticalAlert() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (selectedRowIndex === null) {<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>alert('Select a row first.');<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>return;<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Check if the selected row has a critical alert</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const noteCell = selectedRawNotes || '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!noteCell.includes('[CRITICAL_ALERT]')) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>alert('No critical alert found on this row.');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!confirm('Remove the critical alert from this row?')) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Remove all critical alert lines</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const cleaned = noteCell</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>.split('\n')</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>.filter(line =&gt; !line.startsWith('[CRITICAL_ALERT]'))</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>.join('\n')</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>.trim();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const params = new URLSearchParams({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>action: 'edit',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>password: sessionPassword,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>row: selectedRowIndex,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>username: domCache.username ? domCache.username.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>passwordField: domCache.password ? domCache.password.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>email: domCache.email ? domCache.email.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>phone: normalizePhone(domCache.phone ? domCache.phone.value.trim() : ''),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>server: domCache.server ? domCache.server.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>autoPay: domCache.autoPay ? domCache.autoPay.value.trim() : '',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>notes: cleaned</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setBusy('.remove-alert-btn', true);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>fetch(scriptURL, { method: 'POST', body: params })</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>.then(r =&gt; r.text())</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>.then(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>alert('Critical alert removed successfully.');</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Update local cache and UI</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>selectedRawNotes = cleaned;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const rec = allRecords.find(r =&gt; r.sheetRow === selectedRowIndex);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (rec) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>rec.row[6] = cleaned;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>rec.lastEditMs = Date.now();</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">              </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>// Update the selected row in the table</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>const selectedTr = document.querySelector('#dataTable tr.selected');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">              </span>if (selectedTr) selectedTr.innerHTML = tdHTML(rec.row);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Resort and re-render</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>sortRecords(allRecords);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>renderTable(allRecords.slice(0, ROW_LIMIT));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>})</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>.catch(err =&gt; alert('Failed to remove critical alert: ' + err))</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">          </span>.finally(() =&gt; setBusy('.remove-alert-btn', false));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>window.removeCriticalAlert = removeCriticalAlert;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;/script&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">&lt;/body&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">&lt;/html&gt;</span></p>
</body>
</html>
